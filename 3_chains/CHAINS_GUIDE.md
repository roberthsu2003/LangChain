# Chain é¡å‹å®Œæ•´æŒ‡å—

> ğŸ“– **é–±è®€æ™‚é–“**ï¼šç´„ 30 åˆ†é˜ | [è¿”å›ä¸»é ](README.md)

æœ¬æŒ‡å—è©³ç´°ä»‹ç´¹ LangChain ä¸­çš„ 10 ç¨® Chain é¡å‹ï¼Œå¾åŸºç¤å…¥é–€åˆ°æœ€ä½³å¯¦è¸ï¼Œå¹«åŠ©ä½ å¾ªåºæ¼¸é€²åœ°æŒæ¡ Chain çš„ä½¿ç”¨æ–¹æ³•ã€‚

---

## ğŸ“‘ ç›®éŒ„

- [åŸºç¤å…¥é–€ï¼ˆâ­-â­â­ï¼‰](#åŸºç¤å…¥é–€)
  - [1ï¸âƒ£ åŸºç¤éˆ](#1ï¸âƒ£-åŸºç¤éˆ-basic-chains---å…¥é–€å¿…å­¸)
  - [2ï¸âƒ£ æ“´å±•éˆ](#2ï¸âƒ£-æ“´å±•éˆ-extended-chains---è‡ªå®šç¾©è™•ç†)
- [é€²éšæ‡‰ç”¨ï¼ˆâ­â­â­ï¼‰](#é€²éšæ‡‰ç”¨)
  - [3ï¸âƒ£ ä¸¦è¡Œéˆ](#3ï¸âƒ£-ä¸¦è¡Œéˆ-parallel-chains---æ•ˆç‡å„ªåŒ–)
  - [4ï¸âƒ£ åˆ†æ”¯éˆ](#4ï¸âƒ£-åˆ†æ”¯éˆ-branching-chains---æ™ºèƒ½è·¯ç”±)
  - [5ï¸âƒ£ ä¸²è¯æ¨¡å‹éˆ](#5ï¸âƒ£-ä¸²è¯æ¨¡å‹éˆ-sequential-model-chains---å¤šæ­¥é©Ÿè™•ç†)
- [æ·±åº¦æŒæ¡ï¼ˆâ­â­â­â­ï¼‰](#æ·±åº¦æŒæ¡)
  - [6ï¸âƒ£ å…§éƒ¨é‹ä½œ](#6ï¸âƒ£-éˆçš„å…§éƒ¨é‹ä½œ-chains-under-the-hood---æ·±å…¥ç†è§£)
  - [7ï¸âƒ£ é–‰åŒ…æ¨¡å‹éˆ](#7ï¸âƒ£-é–‰åŒ…æ¨¡å‹éˆ-closure-model-chains---å®Œå…¨æ§åˆ¶)
  - [8ï¸âƒ£ ä¸¦è¡Œæ¨¡å‹éˆ](#8ï¸âƒ£-ä¸¦è¡Œæ¨¡å‹éˆ-parallel-model-chains---å¤šè§’åº¦åˆ†æ)
- [æœ€ä½³å¯¦è¸ï¼ˆâ­â­â­â­â­ï¼‰](#æœ€ä½³å¯¦è¸)
  - [9ï¸âƒ£ å‹•æ…‹æç¤ºéˆ](#9ï¸âƒ£-å‹•æ…‹æç¤ºéˆ-dynamic-prompt-chains---æ¨è–¦æœ€ä½³å¯¦è¸-â­)
  - [ğŸ”Ÿ Lambda æ¨¡å‹æ•´åˆ](#ğŸ”Ÿ-lambda-æ¨¡å‹æ•´åˆ-lambda-model-integration---ç¶œåˆé€²éš)

---

## åŸºç¤å…¥é–€

### 1ï¸âƒ£ åŸºç¤éˆ (Basic Chains) - å…¥é–€å¿…å­¸

**é›£åº¦**ï¼šâ­

#### ğŸ¯ å­¸ç¿’ç›®æ¨™
æŒæ¡ LCEL çš„åŸºæœ¬èªæ³•ï¼Œå»ºç«‹ç¬¬ä¸€å€‹ AI æ‡‰ç”¨

#### ğŸ“ æ ¸å¿ƒæ¦‚å¿µ
```python
# æœ€åŸºæœ¬çš„éˆçµ„åˆ
chain = prompt_template | model | StrOutputParser()
```

é€™æ˜¯ LangChain æœ€åŸºæœ¬ä¹Ÿæœ€é‡è¦çš„èªæ³•ã€‚ä½¿ç”¨ç®¡é“ç¬¦è™Ÿ `|` å°‡ä¸‰å€‹å…ƒä»¶ä¸²æ¥èµ·ä¾†ï¼š
1. **Prompt Template**ï¼šæ ¼å¼åŒ–ä½¿ç”¨è€…è¼¸å…¥
2. **Model**ï¼šèª¿ç”¨ AI æ¨¡å‹
3. **StrOutputParser**ï¼šå°‡æ¨¡å‹è¼¸å‡ºè§£æç‚ºå­—ä¸²

#### ğŸ’¡ ç°¡å–®ç¯„ä¾‹
**æ™ºèƒ½å•ç­”ç³»çµ±** - æ ¹æ“šä¸»é¡Œå›ç­”å•é¡Œ

```python
from langchain.prompts import ChatPromptTemplate
from langchain.schema.output_parser import StrOutputParser
from langchain_ollama.llms import OllamaLLM

# å»ºç«‹æ¨¡å‹
model = OllamaLLM(model="llama3.2:latest")

# å»ºç«‹æç¤ºæ¨¡æ¿
prompt = ChatPromptTemplate.from_template("è«‹ç”¨ä¸€æ®µè©±ä»‹ç´¹ {topic}")

# å»ºç«‹éˆ
chain = prompt | model | StrOutputParser()

# åŸ·è¡Œ
result = chain.invoke({"topic": "äººå·¥æ™ºæ…§"})
print(result)
```

#### ğŸ”§ å¯¦éš›æ‡‰ç”¨
- âœ… å®¢æœç³»çµ±å›ç­”å¸¸è¦‹å•é¡Œ
- âœ… å­¸ç¿’åŠ©æ‰‹è§£é‡‹å­¸ç§‘æ¦‚å¿µ
- âœ… æŠ€è¡“æ”¯æ´æä¾›è§£æ±ºæ–¹æ¡ˆ
- âœ… å…§å®¹æ‘˜è¦ç”Ÿæˆ

#### ğŸ“ ç¯„ä¾‹æª”æ¡ˆ
- [åŸºç¤éˆ - Ollama ç‰ˆæœ¬](1_chains_basics_ollama.ipynb) â­ **æ¨è–¦åˆå­¸è€…**
- [åŸºç¤éˆ - Gemini ç‰ˆæœ¬](1_chains_basics_gemini.ipynb)

---

### 2ï¸âƒ£ æ“´å±•éˆ (Extended Chains) - è‡ªå®šç¾©è™•ç†

**é›£åº¦**ï¼šâ­â­

#### ğŸ¯ å­¸ç¿’ç›®æ¨™
åœ¨éˆä¸­åŠ å…¥è‡ªå®šç¾©çš„è™•ç†é‚è¼¯ï¼Œå¯¦ç¾æ•¸æ“šè½‰æ›å’Œå¾Œè™•ç†

#### ğŸ“ æ ¸å¿ƒæ¦‚å¿µ
```python
# æ·»åŠ è‡ªå®šç¾©è™•ç†æ­¥é©Ÿ
def custom_processing(text):
    # è‡ªå®šç¾©è™•ç†é‚è¼¯
    return text.upper()

chain = (
    prompt_template
    | model
    | StrOutputParser()
    | custom_processing  # æ·»åŠ è‡ªå®šç¾©è™•ç†
)
```

ä½¿ç”¨ Python å‡½æ•¸æˆ– `RunnableLambda` å¯ä»¥åœ¨éˆä¸­æ·»åŠ ä»»ä½•è‡ªå®šç¾©é‚è¼¯ï¼Œä¾‹å¦‚ï¼š
- æ ¼å¼åŒ–è¼¸å‡º
- æ•¸æ“šæ¸…ç†
- æ·»åŠ çµ±è¨ˆè³‡è¨Š
- æ¢ä»¶åˆ¤æ–·

#### ğŸ’¡ ç°¡å–®ç¯„ä¾‹
**æ™ºèƒ½éƒµä»¶å›è¦†ç³»çµ±** - åŒ…å«æ ¼å¼åŒ–å’Œå“è³ªæª¢æŸ¥

```python
def format_email_reply(reply):
    """æ ¼å¼åŒ–éƒµä»¶å›è¦†"""
    formatted = f"""
è¦ªæ„›çš„å®¢æˆ¶ï¼Œ

{reply}

æ„Ÿè¬æ‚¨çš„ä¾†ä¿¡ï¼Œå¦‚æœ‰å…¶ä»–å•é¡Œè«‹éš¨æ™‚è¯ç¹«æˆ‘å€‘ã€‚

æ­¤è‡´
å®¢æœåœ˜éšŠ
"""
    return formatted

chain = prompt | model | StrOutputParser() | format_email_reply
```

#### ğŸ”§ å¯¦éš›æ‡‰ç”¨
- âœ… æ•¸æ“šæ¸…ç†å’Œæ ¼å¼åŒ–
- âœ… æ·»åŠ çµ±è¨ˆè³‡è¨Šæˆ–åˆ†æ
- âœ… å…§å®¹å“è³ªæª¢æŸ¥å’Œå„ªåŒ–
- âœ… å¤šèªè¨€ç¿»è­¯å¾Œè™•ç†

#### ğŸ“ ç¯„ä¾‹æª”æ¡ˆ
- [æ“´å±•éˆ - Ollama ç‰ˆæœ¬](2_chains_extended_ollama.ipynb) â­ **æ¨è–¦åˆå­¸è€…**
- [æ“´å±•éˆ - Gemini ç‰ˆæœ¬](2_chains_extended_gemini.ipynb)

---

## é€²éšæ‡‰ç”¨

### 3ï¸âƒ£ ä¸¦è¡Œéˆ (Parallel Chains) - æ•ˆç‡å„ªåŒ–

**é›£åº¦**ï¼šâ­â­â­

#### ğŸ¯ å­¸ç¿’ç›®æ¨™
åŒæ™‚åŸ·è¡Œå¤šå€‹åˆ†æä»»å‹™ï¼Œæå‡è™•ç†æ•ˆç‡

#### ğŸ“ æ ¸å¿ƒæ¦‚å¿µ
```python
from langchain.schema.runnable import RunnableParallel

# ä¸¦è¡ŒåŸ·è¡Œå¤šå€‹åˆ†æ
parallel_chain = RunnableParallel(
    branches={
        "pros": analyze_pros_chain,
        "cons": analyze_cons_chain,
        "summary": summarize_chain
    }
)

chain = prompt | model | StrOutputParser() | parallel_chain
```

`RunnableParallel` å…è¨±åŒæ™‚åŸ·è¡Œå¤šå€‹ç¨ç«‹çš„è™•ç†ä»»å‹™ï¼Œçµæœæœƒçµ„åˆæˆä¸€å€‹å­—å…¸è¿”å›ã€‚é€™å¤§å¹…æå‡äº†è™•ç†æ•ˆç‡ã€‚

#### ğŸ’¡ ç°¡å–®ç¯„ä¾‹
**é¤å»³è©•è«–åˆ†æç³»çµ±** - åŒæ™‚åˆ†æå„ªé»å’Œç¼ºé»

```python
# å®šç¾©å„ªé»åˆ†æéˆ
pros_prompt = ChatPromptTemplate.from_template("åˆ†æé€™ç¯‡è©•è«–çš„å„ªé»ï¼š{review}")
pros_chain = pros_prompt | model | StrOutputParser()

# å®šç¾©ç¼ºé»åˆ†æéˆ
cons_prompt = ChatPromptTemplate.from_template("åˆ†æé€™ç¯‡è©•è«–çš„ç¼ºé»ï¼š{review}")
cons_chain = cons_prompt | model | StrOutputParser()

# ä¸¦è¡ŒåŸ·è¡Œ
parallel_analysis = RunnableParallel(
    pros=pros_chain,
    cons=cons_chain
)
```

#### ğŸ”§ å¯¦éš›æ‡‰ç”¨
- âœ… å¤šè§’åº¦åˆ†æåŒä¸€ä»½è³‡æ–™
- âœ… åŒæ™‚åˆ†æå„ªç¼ºé»
- âœ… å¤šå€‹ç¨ç«‹çš„è™•ç†ä»»å‹™
- âœ… æå‡ç³»çµ±ååé‡

#### ğŸ“ ç¯„ä¾‹æª”æ¡ˆ
- [ä¸¦è¡Œéˆ - Ollama ç‰ˆæœ¬](3_chains_parallel_ollama.ipynb) â­ **æ¨è–¦åˆå­¸è€…**
- [ä¸¦è¡Œéˆ - Gemini ç‰ˆæœ¬](3_chains_parallel_gemini.ipynb)

---

### 4ï¸âƒ£ åˆ†æ”¯éˆ (Branching Chains) - æ™ºèƒ½è·¯ç”±

**é›£åº¦**ï¼šâ­â­â­

#### ğŸ¯ å­¸ç¿’ç›®æ¨™
æ ¹æ“šæ¢ä»¶é¸æ“‡ä¸åŒçš„è™•ç†è·¯å¾‘ï¼Œå¯¦ç¾æ™ºèƒ½è·¯ç”±

#### ğŸ“ æ ¸å¿ƒæ¦‚å¿µ
```python
from langchain.schema.runnable import RunnableBranch

# æ ¹æ“šå•é¡Œé¡å‹é¸æ“‡è™•ç†æ–¹å¼
branches = RunnableBranch(
    (lambda x: "æ¦‚å¿µ" in x, concept_explanation_chain),
    (lambda x: "è§£é¡Œ" in x, problem_solving_chain),
    study_advice_chain  # é è¨­åˆ†æ”¯
)

chain = prompt | model | StrOutputParser() | branches
```

`RunnableBranch` æ ¹æ“šæ¢ä»¶åˆ¤æ–·é¸æ“‡ä¸åŒçš„è™•ç†è·¯å¾‘ï¼ŒåªåŸ·è¡Œç¬¦åˆæ¢ä»¶çš„é‚£ä¸€å€‹åˆ†æ”¯ã€‚

#### ğŸ’¡ ç°¡å–®ç¯„ä¾‹
**æ™ºèƒ½å­¸ç¿’åŠ©æ‰‹** - æ ¹æ“šå­¸ç”Ÿå•é¡Œé¡å‹æä¾›ä¸åŒçš„å­¸ç¿’å»ºè­°

#### ğŸ”§ å¯¦éš›æ‡‰ç”¨
- âœ… æ™ºèƒ½å­¸ç¿’åŠ©æ‰‹
- âœ… å®¢æœç³»çµ±è‡ªå‹•åŒ–
- âœ… å…§å®¹åˆ†é¡è™•ç†
- âœ… å¤šæ¢ä»¶æ±ºç­–ç³»çµ±

#### ğŸ“ ç¯„ä¾‹æª”æ¡ˆ
- [åˆ†æ”¯éˆ - Ollama ç‰ˆæœ¬](4_chains_branching_ollama.ipynb) â­ **æ¨è–¦åˆå­¸è€…**
- [åˆ†æ”¯éˆ - Gemini ç‰ˆæœ¬](4_chains_branching_gemini.ipynb)

---

### 5ï¸âƒ£ ä¸²è¯æ¨¡å‹éˆ (Sequential Model Chains) - å¤šæ­¥é©Ÿè™•ç†

**é›£åº¦**ï¼šâ­â­â­

#### ğŸ¯ å­¸ç¿’ç›®æ¨™
é †åºèª¿ç”¨å¤šå€‹æ¨¡å‹ä¾†å¯¦ç¾å¤šæ­¥é©Ÿè™•ç†æµç¨‹

#### ğŸ“ æ ¸å¿ƒæ¦‚å¿µ
```python
# ä¸²è¯å¤šå€‹æ¨¡å‹èª¿ç”¨
chain = (
    reply_prompt | model | StrOutputParser()
    | (lambda x: {"reply": x})
    | format_prompt | model | StrOutputParser()
    | (lambda x: {"formatted": x})
    | improve_prompt | model | StrOutputParser()
)
```

ä¸²è¯æ¨¡å‹éˆé€šéå¤šæ¬¡èª¿ç”¨æ¨¡å‹ï¼Œå¯¦ç¾é€æ­¥æ”¹é€²å’Œå„ªåŒ–çš„æ•ˆæœã€‚æ¯å€‹éšæ®µå°ˆæ³¨æ–¼ä¸€å€‹ç‰¹å®šä»»å‹™ã€‚

#### ğŸ’¡ ç°¡å–®ç¯„ä¾‹
**éƒµä»¶ç”Ÿæˆâ†’æ ¼å¼åŒ–â†’æ”¹é€²ç³»çµ±**

éšæ®µ 1ï¼šç”Ÿæˆåˆæ­¥å›è¦†
éšæ®µ 2ï¼šæ ¼å¼åŒ–éƒµä»¶
éšæ®µ 3ï¼šå“è³ªæª¢æŸ¥å’Œæ”¹é€²

#### ğŸ”§ å¯¦éš›æ‡‰ç”¨
- âœ… å…§å®¹é€æ­¥å„ªåŒ–
- âœ… å¤šè¼ªå°è©±è™•ç†
- âœ… è¤‡é›œä»»å‹™åˆ†æ­¥åŸ·è¡Œ
- âœ… å“è³ªé€æ­¥æå‡

#### ğŸ“ ç¯„ä¾‹æª”æ¡ˆ
- [ä¸²è¯æ¨¡å‹éˆ - Ollama ç‰ˆæœ¬](5_chains_sequential_model_ollama.ipynb)
- [ä¸²è¯æ¨¡å‹éˆ - Gemini ç‰ˆæœ¬](5_chains_sequential_model_gemini.ipynb)

---

## æ·±åº¦æŒæ¡

### 6ï¸âƒ£ éˆçš„å…§éƒ¨é‹ä½œ (Chains Under the Hood) - æ·±å…¥ç†è§£

**é›£åº¦**ï¼šâ­â­â­â­

#### ğŸ¯ å­¸ç¿’ç›®æ¨™
äº†è§£éˆçš„åº•å±¤å¯¦ä½œæ©Ÿåˆ¶ï¼ŒæŒæ¡ RunnableSequence å’Œ RunnableLambda

#### ğŸ“ æ ¸å¿ƒæ¦‚å¿µ

**RunnableLambda** å°±æ˜¯æŠŠã€Œä»»ä½• Python å‡½æ•¸ã€åŒ…è£æˆå¯ä»¥ä¸²æ¥çš„å…ƒä»¶ã€‚

æ‹†è§£æ­¥é©Ÿï¼š

1. **æ‰¾å‡º Chain ä¸­çš„æ¯å€‹è™•ç†æ­¥é©Ÿ**
```python
# åŸæœ¬çš„ Chain
chain = prompt | llm | parser
```

2. **å°‡æ¯å€‹æ­¥é©Ÿå¯«æˆç¨ç«‹å‡½æ•¸**
```python
from langchain_core.runnables import RunnableLambda

def format_prompt(input_dict):
    return prompt.format(**input_dict)

def call_llm(formatted_prompt):
    return llm.invoke(formatted_prompt)

def parse_output(llm_response):
    return parser.parse(llm_response)
```

3. **ç”¨ RunnableLambda åŒ…è£**
```python
step1 = RunnableLambda(format_prompt)
step2 = RunnableLambda(call_llm)
step3 = RunnableLambda(parse_output)

# é‡æ–°çµ„åˆ
custom_chain = step1 | step2 | step3
```

#### ä»€éº¼æ™‚å€™éœ€è¦ RunnableLambdaï¼Ÿ

- éœ€è¦è‡ªè¨‚è³‡æ–™è™•ç†é‚è¼¯
- éœ€è¦è¨˜éŒ„æ—¥èªŒæˆ–é™¤éŒ¯
- éœ€è¦æ¢ä»¶åˆ¤æ–·ï¼ˆæ ¹æ“šè¼¸å…¥æ±ºå®šä¸‹ä¸€æ­¥ï¼‰
- éœ€è¦å‘¼å«å¤–éƒ¨ API æˆ–è³‡æ–™åº«

#### ğŸ’¡ ç°¡å–®ç¯„ä¾‹
**æ–‡å­—æ‘˜è¦ç³»çµ±** - å°‡é•·ç¯‡æ–‡ç« æ¿ƒç¸®æˆç°¡æ½”é‡é»

#### ğŸ”§ å¯¦éš›æ‡‰ç”¨
- âœ… é™¤éŒ¯å’Œå„ªåŒ–éˆçš„æ•ˆèƒ½
- âœ… ç²¾ç´°æ§åˆ¶æ¯å€‹è™•ç†æ­¥é©Ÿ
- âœ… å­¸ç¿’ LangChain çš„å…§éƒ¨æ¶æ§‹
- âœ… è‡ªå®šç¾©è¤‡é›œè™•ç†é‚è¼¯

#### ğŸ“ ç¯„ä¾‹æª”æ¡ˆ
- [éˆçš„å…§éƒ¨é‹ä½œ - Ollama ç‰ˆæœ¬1](6_chains_under_the_hood_ollama1.ipynb)
- [éˆçš„å…§éƒ¨é‹ä½œ - Ollama ç‰ˆæœ¬2](6_chains_under_the_hood_ollama2.ipynb)
- [éˆçš„å…§éƒ¨é‹ä½œ - Gemini ç‰ˆæœ¬](6_chains_under_the_hood_gemini.ipynb)

---

### 7ï¸âƒ£ é–‰åŒ…æ¨¡å‹éˆ (Closure Model Chains) - å®Œå…¨æ§åˆ¶

**é›£åº¦**ï¼šâ­â­â­â­

#### ğŸ¯ å­¸ç¿’ç›®æ¨™
åœ¨ RunnableLambda ä¸­é€šéé–‰åŒ…ç›´æ¥èª¿ç”¨æ¨¡å‹ï¼Œå¯¦ç¾å®Œå…¨è‡ªå®šç¾©çš„è™•ç†é‚è¼¯

#### ğŸ“ æ ¸å¿ƒæ¦‚å¿µ
```python
# åœ¨ Lambda å‡½æ•¸ä¸­æ•ç²å¤–éƒ¨æ¨¡å‹ä¸¦èª¿ç”¨
def format_with_quality_check(reply):
    formatted = format_email(reply)

    # åœ¨å‡½æ•¸å…§éƒ¨ç›´æ¥èª¿ç”¨æ¨¡å‹ï¼ˆé–‰åŒ…ï¼‰
    quality_prompt = ChatPromptTemplate.from_template("è©•ä¼°é€™å°éƒµä»¶ï¼š{email}")
    quality_result = model.invoke(quality_prompt.format(email=formatted))

    return combine_results(formatted, quality_result)

chain = prompt | model | StrOutputParser() | RunnableLambda(format_with_quality_check)
```

é–‰åŒ…æ¨¡å‹éˆè®“ä½ åœ¨å‡½æ•¸å…§éƒ¨å®Œå…¨æ§åˆ¶æ¨¡å‹çš„èª¿ç”¨æ™‚æ©Ÿå’Œæ–¹å¼ï¼Œé©åˆéœ€è¦è¤‡é›œé‚è¼¯çš„å ´æ™¯ã€‚

#### ğŸ’¡ ç°¡å–®ç¯„ä¾‹
**éƒµä»¶å›è¦†å“è³ªæª¢æŸ¥ç³»çµ±** - æ ¼å¼åŒ–å¾Œè‡ªå‹•èª¿ç”¨æ¨¡å‹é€²è¡Œå“è³ªè©•ä¼°

#### ğŸ”§ å¯¦éš›æ‡‰ç”¨
- âœ… è¤‡é›œæ¢ä»¶åˆ¤æ–·å’Œå¤šæ­¥è™•ç†
- âœ… éœ€è¦å®Œå…¨æ§åˆ¶æ¨¡å‹èª¿ç”¨é‚è¼¯
- âœ… æ·»åŠ æ—¥èªŒè¨˜éŒ„å’Œç›£æ§
- âœ… è‡ªå®šç¾©éŒ¯èª¤è™•ç†

#### âš ï¸ æ³¨æ„äº‹é …
- å¯è®€æ€§è¼ƒå·®ï¼Œé‚è¼¯éš±è—åœ¨å‡½æ•¸å…§éƒ¨
- é™¤éŒ¯è¼ƒå›°é›£
- å»ºè­°å„ªå…ˆä½¿ç”¨[å‹•æ…‹æç¤ºéˆ](#9ï¸âƒ£-å‹•æ…‹æç¤ºéˆ-dynamic-prompt-chains---æ¨è–¦æœ€ä½³å¯¦è¸-â­)

#### ğŸ“ ç¯„ä¾‹æª”æ¡ˆ
- [é–‰åŒ…æ¨¡å‹éˆ - Ollama ç‰ˆæœ¬](7_chains_closure_model_ollama.ipynb)
- [é–‰åŒ…æ¨¡å‹éˆ - Gemini ç‰ˆæœ¬](7_chains_closure_model_gemini.ipynb)

---

### 8ï¸âƒ£ ä¸¦è¡Œæ¨¡å‹éˆ (Parallel Model Chains) - å¤šè§’åº¦åˆ†æ

**é›£åº¦**ï¼šâ­â­â­â­

#### ğŸ¯ å­¸ç¿’ç›®æ¨™
ä½¿ç”¨ RunnableParallel åŒæ™‚èª¿ç”¨å¤šå€‹æ¨¡å‹é€²è¡Œä¸åŒè§’åº¦çš„åˆ†æ

#### ğŸ“ æ ¸å¿ƒæ¦‚å¿µ
```python
# ä¸¦è¡ŒåŸ·è¡Œå¤šå€‹æ¨¡å‹åˆ†æ
parallel_chain = RunnableParallel(
    formatted=RunnableLambda(format_email),
    quality_check=quality_check_chain | model | StrOutputParser(),
    tone_analysis=tone_analysis_chain | model | StrOutputParser()
)

chain = prompt | model | StrOutputParser() | parallel_chain
```

ä¸¦è¡Œæ¨¡å‹éˆçµåˆäº†ä¸¦è¡Œéˆå’Œå¤šæ¨¡å‹èª¿ç”¨ï¼Œå¯ä»¥åŒæ™‚å¾å¤šå€‹è§’åº¦åˆ†æåŒä¸€ä»½å…§å®¹ã€‚

#### ğŸ’¡ ç°¡å–®ç¯„ä¾‹
**éƒµä»¶å¤šç¶­åº¦åˆ†æç³»çµ±** - åŒæ™‚è©•ä¼°å“è³ªå’Œèªæ°£

#### ğŸ”§ å¯¦éš›æ‡‰ç”¨
- âœ… å¤šè§’åº¦å…§å®¹åˆ†æ
- âœ… åŒæ™‚ç²å–å¤šç¨®è©•ä¼°çµæœ
- âœ… æå‡è™•ç†æ•ˆç‡
- âœ… ç¶œåˆå¤šå€‹æ¨¡å‹çš„åˆ¤æ–·

#### ğŸ“ ç¯„ä¾‹æª”æ¡ˆ
- [ä¸¦è¡Œæ¨¡å‹éˆ - Ollama ç‰ˆæœ¬](8_chains_parallel_model_ollama.ipynb)
- [ä¸¦è¡Œæ¨¡å‹éˆ - Gemini ç‰ˆæœ¬](8_chains_parallel_model_gemini.ipynb)

---

## æœ€ä½³å¯¦è¸

### 9ï¸âƒ£ å‹•æ…‹æç¤ºéˆ (Dynamic Prompt Chains) - æ¨è–¦æœ€ä½³å¯¦è¸ â­

**é›£åº¦**ï¼šâ­â­â­â­â­

#### ğŸ¯ å­¸ç¿’ç›®æ¨™
æ ¹æ“šå…§å®¹å‹•æ…‹æº–å‚™ Promptï¼Œç„¶å¾Œä¸²æ¥æ¨¡å‹èª¿ç”¨ - **é€™æ˜¯æœ€æ¨è–¦çš„æ–¹æ³•**

#### ğŸ“ æ ¸å¿ƒæ¦‚å¿µ
```python
# Lambda åªè² è²¬æº–å‚™æ•¸æ“šï¼Œä¸ç›´æ¥èª¿ç”¨æ¨¡å‹
def prepare_quality_check_prompt(reply):
    formatted = format_email(reply)

    # æ ¹æ“šå…§å®¹å‹•æ…‹æ±ºå®šæª¢æŸ¥é‡é»
    if "é€€è²¨" in reply:
        focus = "è«‹ç‰¹åˆ¥æ³¨æ„é€€æ›è²¨æ”¿ç­–èªªæ˜"
    elif "æŠ±æ­‰" in reply:
        focus = "è«‹ç‰¹åˆ¥æ³¨æ„é“æ­‰èª æ„"
    else:
        focus = "è«‹è©•ä¼°æ•´é«”å°ˆæ¥­åº¦"

    return {"email": formatted, "focus": focus}

# å‹•æ…‹ Prompt Template
dynamic_prompt = ChatPromptTemplate.from_messages([
    ("system", "ä½ æ˜¯éƒµä»¶å“è³ªå°ˆå®¶ã€‚{focus}"),
    ("human", "è©•ä¼°é€™å°éƒµä»¶ï¼š\\n\\n{email}")
])

chain = (
    prompt | model | StrOutputParser()
    | RunnableLambda(prepare_quality_check_prompt)
    | dynamic_prompt | model | StrOutputParser()
)
```

#### ğŸŒŸ ç‚ºä»€éº¼é€™æ˜¯æœ€ä½³å¯¦è¸ï¼Ÿ

1. **çµæ§‹æ¸…æ™°**ï¼šéˆçš„æµç¨‹ä¸€ç›®äº†ç„¶
2. **æ˜“æ–¼ç¶­è­·**ï¼šPrompt å’Œè™•ç†é‚è¼¯åˆ†é›¢
3. **é«˜åº¦éˆæ´»**ï¼šå¯ä»¥æ ¹æ“šå…§å®¹å‹•æ…‹èª¿æ•´
4. **ä¾¿æ–¼èª¿è©¦**ï¼šæ¯å€‹æ­¥é©Ÿéƒ½å¯ä»¥å–®ç¨æ¸¬è©¦

#### ğŸ’¡ ç°¡å–®ç¯„ä¾‹
**æ™ºèƒ½éƒµä»¶åˆ†æç³»çµ±** - æ ¹æ“šå…§å®¹é¡å‹å‹•æ…‹èª¿æ•´æª¢æŸ¥é‡é»

#### ğŸ”§ å¯¦éš›æ‡‰ç”¨
- âœ… è‡ªé©æ‡‰è™•ç†æµç¨‹
- âœ… æ™ºèƒ½è·¯ç”±å¢å¼·ç‰ˆ
- âœ… æ ¹æ“šå…§å®¹å‹•æ…‹èª¿æ•´é‚è¼¯
- âœ… æœ€ä½³çš„å¯ç¶­è­·æ€§å’Œéˆæ´»æ€§

#### ğŸ“Š èˆ‡å…¶ä»–æ–¹æ³•çš„æ¯”è¼ƒ

| æ–¹æ³• | å¯è®€æ€§ | éˆæ´»æ€§ | ç¶­è­·æ€§ | æ¨è–¦åº¦ |
|------|--------|--------|--------|--------|
| **å‹•æ…‹æç¤ºéˆ** | â­â­â­â­â­ | â­â­â­â­â­ | â­â­â­â­â­ | ğŸ† æœ€æ¨è–¦ |
| é–‰åŒ…æ¨¡å‹éˆ | â­â­ | â­â­â­â­â­ | â­â­ | è¬¹æ…ä½¿ç”¨ |
| ä¸¦è¡Œæ¨¡å‹éˆ | â­â­â­â­ | â­â­â­ | â­â­â­â­ | ç‰¹å®šå ´æ™¯ |
| ä¸²è¯æ¨¡å‹éˆ | â­â­â­â­ | â­â­ | â­â­â­â­ | ç°¡å–®å ´æ™¯ |

#### ğŸ“ ç¯„ä¾‹æª”æ¡ˆ
- [å‹•æ…‹æç¤ºéˆ - Ollama ç‰ˆæœ¬](9_chains_dynamic_prompt_ollama.ipynb) â­ **æ¨è–¦æœ€ä½³å¯¦è¸**
- [å‹•æ…‹æç¤ºéˆ - Gemini ç‰ˆæœ¬](9_chains_dynamic_prompt_gemini.ipynb)

---

### ğŸ”Ÿ Lambda æ¨¡å‹æ•´åˆ (Lambda Model Integration) - ç¶œåˆé€²éš

**é›£åº¦**ï¼šâ­â­â­â­â­

#### ğŸ¯ å­¸ç¿’ç›®æ¨™
ç¶œåˆå­¸ç¿’å››ç¨®åœ¨ Lambda ä¸­ä½¿ç”¨æ¨¡å‹çš„æ–¹æ³•

#### ğŸ“ æ ¸å¿ƒæ¦‚å¿µ
é€™æ˜¯ä¸€å€‹ç¶œåˆç¯„ä¾‹ï¼Œå±•ç¤ºäº†ï¼š

1. **é–‰åŒ…æ–¹å¼** ([7ï¸âƒ£](#7ï¸âƒ£-é–‰åŒ…æ¨¡å‹éˆ-closure-model-chains---å®Œå…¨æ§åˆ¶)) - åœ¨ Lambda ä¸­ç›´æ¥èª¿ç”¨å¤–éƒ¨æ¨¡å‹
2. **ä¸¦è¡Œè™•ç†** ([8ï¸âƒ£](#8ï¸âƒ£-ä¸¦è¡Œæ¨¡å‹éˆ-parallel-model-chains---å¤šè§’åº¦åˆ†æ)) - ä½¿ç”¨ RunnableParallel åŒæ™‚åŸ·è¡Œå¤šå€‹ä»»å‹™
3. **ä¸²è¯èª¿ç”¨** ([5ï¸âƒ£](#5ï¸âƒ£-ä¸²è¯æ¨¡å‹éˆ-sequential-model-chains---å¤šæ­¥é©Ÿè™•ç†)) - é€£çºŒèª¿ç”¨å¤šå€‹æ¨¡å‹é€²è¡Œå¤šæ­¥é©Ÿæ¨ç†
4. **å‹•æ…‹ä¸²æ¥** ([9ï¸âƒ£](#9ï¸âƒ£-å‹•æ…‹æç¤ºéˆ-dynamic-prompt-chains---æ¨è–¦æœ€ä½³å¯¦è¸-â­)) - Lambda è¿”å› Prompt + æ¨¡å‹çš„çµ„åˆéˆï¼ˆæ¨è–¦ï¼‰

#### ğŸ’¡ ç°¡å–®ç¯„ä¾‹
**ç¶œåˆéƒµä»¶è™•ç†ç³»çµ±** - å±•ç¤ºå››ç¨®æ–¹æ³•çš„å°æ¯”å’Œæ‡‰ç”¨

#### ğŸ”§ å¯¦éš›æ‡‰ç”¨
- âœ… ä½œç‚ºå­¸ç¿’åƒè€ƒï¼Œç†è§£ä¸åŒæ–¹æ³•çš„å·®ç•°
- âœ… æ ¹æ“šå¯¦éš›éœ€æ±‚é¸æ“‡æœ€åˆé©çš„æ–¹æ³•
- âœ… **å»ºè­°å„ªå…ˆä½¿ç”¨æ–¹æ³• 4ï¼ˆå‹•æ…‹æç¤ºéˆï¼‰**

#### ğŸ“ ç¯„ä¾‹æª”æ¡ˆ
- [Lambda æ¨¡å‹æ•´åˆç¶œåˆç¯„ä¾‹](10_chains_lambda_integration_ollama.ipynb)

---

## ğŸ“Œ å¿«é€Ÿå°è¦½

### æŒ‰é›£åº¦é¸æ“‡
- **åˆå­¸è€…ï¼ˆâ­-â­â­ï¼‰**ï¼šå¾ [1ï¸âƒ£ åŸºç¤éˆ](#1ï¸âƒ£-åŸºç¤éˆ-basic-chains---å…¥é–€å¿…å­¸) å’Œ [2ï¸âƒ£ æ“´å±•éˆ](#2ï¸âƒ£-æ“´å±•éˆ-extended-chains---è‡ªå®šç¾©è™•ç†) é–‹å§‹
- **é€²éšé–‹ç™¼è€…ï¼ˆâ­â­â­ï¼‰**ï¼šå­¸ç¿’ [3ï¸âƒ£ ä¸¦è¡Œéˆ](#3ï¸âƒ£-ä¸¦è¡Œéˆ-parallel-chains---æ•ˆç‡å„ªåŒ–)ã€[4ï¸âƒ£ åˆ†æ”¯éˆ](#4ï¸âƒ£-åˆ†æ”¯éˆ-branching-chains---æ™ºèƒ½è·¯ç”±)ã€[5ï¸âƒ£ ä¸²è¯æ¨¡å‹éˆ](#5ï¸âƒ£-ä¸²è¯æ¨¡å‹éˆ-sequential-model-chains---å¤šæ­¥é©Ÿè™•ç†)
- **æ·±å…¥æŒæ¡ï¼ˆâ­â­â­â­ï¼‰**ï¼šç†è§£ [6ï¸âƒ£ å…§éƒ¨é‹ä½œ](#6ï¸âƒ£-éˆçš„å…§éƒ¨é‹ä½œ-chains-under-the-hood---æ·±å…¥ç†è§£) ä¸¦ç·´ç¿’ [7ï¸âƒ£ é–‰åŒ…æ¨¡å‹éˆ](#7ï¸âƒ£-é–‰åŒ…æ¨¡å‹éˆ-closure-model-chains---å®Œå…¨æ§åˆ¶) å’Œ [8ï¸âƒ£ ä¸¦è¡Œæ¨¡å‹éˆ](#8ï¸âƒ£-ä¸¦è¡Œæ¨¡å‹éˆ-parallel-model-chains---å¤šè§’åº¦åˆ†æ)
- **æœ€ä½³å¯¦è¸ï¼ˆâ­â­â­â­â­ï¼‰**ï¼šé‡é»æŒæ¡ [9ï¸âƒ£ å‹•æ…‹æç¤ºéˆ](#9ï¸âƒ£-å‹•æ…‹æç¤ºéˆ-dynamic-prompt-chains---æ¨è–¦æœ€ä½³å¯¦è¸-â­)

### æŒ‰éœ€æ±‚é¸æ“‡
- **éœ€è¦æ•ˆç‡å„ªåŒ–**ï¼š[3ï¸âƒ£ ä¸¦è¡Œéˆ](#3ï¸âƒ£-ä¸¦è¡Œéˆ-parallel-chains---æ•ˆç‡å„ªåŒ–)ã€[8ï¸âƒ£ ä¸¦è¡Œæ¨¡å‹éˆ](#8ï¸âƒ£-ä¸¦è¡Œæ¨¡å‹éˆ-parallel-model-chains---å¤šè§’åº¦åˆ†æ)
- **éœ€è¦æ¢ä»¶åˆ¤æ–·**ï¼š[4ï¸âƒ£ åˆ†æ”¯éˆ](#4ï¸âƒ£-åˆ†æ”¯éˆ-branching-chains---æ™ºèƒ½è·¯ç”±)ã€[9ï¸âƒ£ å‹•æ…‹æç¤ºéˆ](#9ï¸âƒ£-å‹•æ…‹æç¤ºéˆ-dynamic-prompt-chains---æ¨è–¦æœ€ä½³å¯¦è¸-â­)
- **éœ€è¦å¤šæ­¥è™•ç†**ï¼š[5ï¸âƒ£ ä¸²è¯æ¨¡å‹éˆ](#5ï¸âƒ£-ä¸²è¯æ¨¡å‹éˆ-sequential-model-chains---å¤šæ­¥é©Ÿè™•ç†)
- **éœ€è¦æ·±å…¥ç†è§£**ï¼š[6ï¸âƒ£ å…§éƒ¨é‹ä½œ](#6ï¸âƒ£-éˆçš„å…§éƒ¨é‹ä½œ-chains-under-the-hood---æ·±å…¥ç†è§£)
- **éœ€è¦æœ€ä½³æ–¹æ¡ˆ**ï¼š[9ï¸âƒ£ å‹•æ…‹æç¤ºéˆ](#9ï¸âƒ£-å‹•æ…‹æç¤ºéˆ-dynamic-prompt-chains---æ¨è–¦æœ€ä½³å¯¦è¸-â­) â­

---

## ğŸ”— ç›¸é—œæ–‡æª”

- ğŸ“– [å­¸ç¿’è·¯å¾‘å»ºè­°](LEARNING_PATHS.md) - é¸æ“‡é©åˆä½ çš„å­¸ç¿’è·¯ç·š
- ğŸ’¼ [å¯¦æˆ°æ¡ˆä¾‹](PRACTICAL_CASES.md) - çœŸå¯¦æ‡‰ç”¨å ´æ™¯
- ğŸ”§ [æŠ€è¡“æ·±å…¥æŒ‡å—](TECHNICAL_GUIDE.md) - LCEL å’Œæœ€ä½³å¯¦è¸
- ğŸ“‹ [ç¸½çµèˆ‡åƒè€ƒ](SUMMARY.md) - å¿«é€ŸæŸ¥è©¢è¡¨
- [è¿”å›ä¸»é ](README.md)
