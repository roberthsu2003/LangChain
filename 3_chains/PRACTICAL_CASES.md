# 實戰案例與應用場景

> 📖 **閱讀時間**：約 20 分鐘 | [返回主頁](README.md)

本指南提供真實的應用案例和詳細的場景分析，幫助你將所學技術應用到實際項目中。

---

## 📑 目錄

- [實戰案例](#-實戰案例含-gradio-互動介面)
  - [案例 1：智能客服系統](#-案例-1智能客服系統)
  - [案例 2：內容分析與報告生成系統](#-案例-2內容分析與報告生成系統)
- [實際應用場景](#-實際應用場景詳解)
- [Chain 類型選擇決策樹](#-chain-類型選擇決策樹)
- [學習測驗](#-學習測驗)

---

## 💼 實戰案例（含 Gradio 互動介面）

我們提供了兩個真實的公司應用案例，幫助你將所學技術應用到實際場景。

### 📋 案例 1：智能客服系統

#### 專案概述
自動識別客戶問題類型並提供專業回應的智能客服系統。

#### 使用技術
- **分支鏈 (RunnableBranch)**：根據問題類型路由到不同處理流程
- **擴展鏈 (RunnableLambda)**：格式化回覆並添加時間戳記

#### 功能特點
- ✅ 自動識別問題類型（投訴、退換貨、產品諮詢、一般問題）
- ✅ 針對不同類型提供專業回應
- ✅ 自動格式化回覆並添加時間戳記
- ✅ Gradio 網頁介面，易於測試

#### 核心代碼結構
```python
from langchain.schema.runnable import RunnableBranch

# 定義不同類型的處理鏈
complaint_chain = complaint_prompt | model | StrOutputParser()
return_chain = return_prompt | model | StrOutputParser()
product_chain = product_prompt | model | StrOutputParser()
general_chain = general_prompt | model | StrOutputParser()

# 建立分支路由
branches = RunnableBranch(
    (lambda x: "投訴" in x or "抱怨" in x, complaint_chain),
    (lambda x: "退貨" in x or "換貨" in x, return_chain),
    (lambda x: "產品" in x or "功能" in x, product_chain),
    general_chain  # 預設分支
)

# 添加格式化處理
def format_response(reply):
    timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
    return f"""
【客服回覆】
{reply}

---
回覆時間：{timestamp}
客服團隊
"""

# 完整鏈
customer_service_chain = classify_chain | branches | format_response
```

#### 應用場景
- 📧 電商平台客服自動化
- 🏢 SaaS 公司技術支援
- 🏪 實體店線上客服
- 🎧 呼叫中心輔助系統

#### 執行方式
```bash
cd 3_chains
python case1_customer_service_system.py
# 在瀏覽器開啟 http://localhost:7860
```

#### 檔案位置
- 📁 [case1_customer_service_system.py](case1_customer_service_system.py)

#### 學習重點
1. 如何使用 `RunnableBranch` 實現智能路由
2. 如何設計清晰的條件判斷邏輯
3. 如何格式化和美化輸出結果

---

### 📊 案例 2：內容分析與報告生成系統

#### 專案概述
並行執行多維度分析並自動生成專業報告的系統。

#### 使用技術
- **並行鏈 (RunnableParallel)**：同時執行 4 種分析
- **擴展鏈 (RunnableLambda)**：合併結果並生成報告

#### 功能特點
- ✅ 同時執行 4 種分析（情感分析、關鍵字提取、受眾分析、改善建議）
- ✅ 並行處理，效能提升 75%
- ✅ 自動生成格式化的分析報告
- ✅ Gradio 網頁介面，即時查看結果

#### 核心代碼結構
```python
from langchain.schema.runnable import RunnableParallel

# 定義四個分析鏈
sentiment_chain = sentiment_prompt | model | StrOutputParser()
keywords_chain = keywords_prompt | model | StrOutputParser()
audience_chain = audience_prompt | model | StrOutputParser()
improvement_chain = improvement_prompt | model | StrOutputParser()

# 建立並行處理
parallel_analysis = RunnableParallel(
    sentiment=sentiment_chain,
    keywords=keywords_chain,
    audience=audience_chain,
    improvement=improvement_chain
)

# 合併結果
def generate_report(results):
    report = f"""
# 內容分析報告

## 1. 情感分析
{results['sentiment']}

## 2. 關鍵字提取
{results['keywords']}

## 3. 目標受眾分析
{results['audience']}

## 4. 改善建議
{results['improvement']}

---
分析時間：{datetime.now().strftime("%Y-%m-%d %H:%M:%S")}
"""
    return report

# 完整鏈
content_analysis_chain = input_chain | parallel_analysis | generate_report
```

#### 應用場景
- 📱 社群媒體內容管理
- 📝 內容行銷效果分析
- 🔍 品牌輿情監測
- 📊 市場調研報告生成

#### 效能對比
| 處理方式 | 執行時間 | 效能提升 |
|---------|---------|---------|
| 順序執行 | 約 40 秒 | - |
| 並行執行 | 約 10 秒 | ⬆️ 75% |

#### 執行方式
```bash
cd 3_chains
python case2_content_analysis_system.py
# 在瀏覽器開啟 http://localhost:7861
```

#### 檔案位置
- 📁 [case2_content_analysis_system.py](case2_content_analysis_system.py)

#### 學習重點
1. 如何使用 `RunnableParallel` 提升效率
2. 如何設計並行任務的分工
3. 如何合併和格式化多個分析結果

---

## 💡 實際應用場景詳解

### 🛒 場景 1：電商平台

#### 常見需求
- 商品描述自動生成
- 評論情感分析
- 智能客服
- 個性化推薦文案

#### 技術方案設計

**1. 商品描述生成器**
```
使用：基礎鏈 (1️⃣)
流程：商品資訊 → Prompt Template → Model → 商品描述
```

**2. 評論多維度分析**
```
使用：並行鏈 (3️⃣)
流程：評論 → 並行分析（優點/缺點/評分） → 綜合報告
```

**3. 智能客服系統**
```
使用：分支鏈 (4️⃣) + 擴展鏈 (2️⃣)
流程：客戶問題 → 問題分類 → 專業回答 → 格式化
```

**4. 個性化推薦文案**
```
使用：動態提示鏈 (9️⃣)
流程：用戶資料 → 動態調整Prompt → Model → 個性化文案
```

#### 實作建議
- 📝 先從商品描述生成開始（最簡單）
- 📊 使用並行鏈分析大量評論（提升效率）
- 🎯 客服系統需要仔細設計分支條件
- ✨ 推薦文案使用動態提示鏈效果最好

---

### 🎧 場景 2：客服系統

#### 常見需求
- 自動問答
- 問題分類路由
- 情感分析
- 優先級判斷

#### 技術方案設計

**1. 基礎問答系統**
```
使用：基礎鏈 (1️⃣)
流程：用戶問題 → 知識庫檢索 → Model → 答案
```

**2. 智能路由系統**（參考案例 1）
```
使用：分支鏈 (4️⃣)
流程：問題 → 類型判斷 → 路由到專業回答鏈
分支：投訴/退換貨/產品諮詢/一般問題
```

**3. 情感分析 + 優先級**
```
使用：並行鏈 (3️⃣) + 擴展鏈 (2️⃣)
流程：問題 → 並行分析（情感/緊急度） → 標記優先級
```

**4. 多輪對話處理**
```
使用：串聯模型鏈 (5️⃣) + Memory
流程：上下文 → 理解意圖 → 生成回覆 → 記錄對話
```

#### 架構圖
```
┌─────────────┐
│ 用戶輸入     │
└──────┬──────┘
       │
       ▼
┌──────────────┐
│ 問題分類      │ ← 分支鏈
└──────┬───────┘
       │
       ├─→ 投訴處理鏈
       ├─→ 退換貨鏈
       ├─→ 產品諮詢鏈
       └─→ 一般問答鏈
            │
            ▼
       ┌────────────┐
       │ 格式化輸出  │ ← 擴展鏈
       └────────────┘
```

#### 實作建議
- 🎯 從簡單分類開始，逐步增加分支
- 📊 使用並行分析提升決策準確度
- 💾 添加對話記憶提升用戶體驗
- ⚡ 優化 Prompt 提升回答品質

---

### ✍️ 場景 3：內容創作工具

#### 常見需求
- 文章大綱生成
- 逐段內容生成
- SEO 優化
- 多版本對比

#### 技術方案設計

**1. 文章大綱生成**
```
使用：基礎鏈 (1️⃣)
流程：主題 → Model → 文章大綱
```

**2. 逐段內容生成**
```
使用：串聯模型鏈 (5️⃣)
流程：大綱 → 第一段 → 第二段 → ... → 完整文章
```

**3. SEO 優化建議**
```
使用：擴展鏈 (2️⃣)
流程：文章 → Model → SEO建議 → 關鍵字標記
```

**4. 多版本生成**
```
使用：並行鏈 (3️⃣)
流程：主題 → 並行生成（正式/輕鬆/專業） → 選擇最佳
```

#### 工作流程圖
```
主題輸入
   │
   ├─→ 生成大綱 (基礎鏈)
   │      │
   │      ├─→ 段落1 ┐
   │      ├─→ 段落2 │ 串聯模型鏈
   │      ├─→ 段落3 │
   │      └─→ 段落4 ┘
   │            │
   │            ▼
   ├─→ SEO優化 (擴展鏈)
   │
   └─→ 生成多版本 (並行鏈)
            │
            ▼
       最終文章
```

#### 實作建議
- 📝 先完成單段生成再串聯
- 🎨 使用分支鏈選擇不同風格
- 🔍 SEO 優化可以並行處理
- ⚡ 多版本生成使用並行鏈最高效

---

### 📊 場景 4：數據分析工具

#### 常見需求
- 數據清理
- 多維度分析
- 報告生成
- 洞察提取

#### 技術方案設計

**1. 數據清理管道**
```
使用：擴展鏈 (2️⃣)
流程：原始數據 → 清理 → 標準化 → 驗證
```

**2. 多維度分析**（參考案例 2）
```
使用：並行模型鏈 (8️⃣)
流程：數據 → 並行分析（趨勢/異常/預測） → 綜合報告
```

**3. 智能報告生成**
```
使用：串聯模型鏈 (5️⃣)
流程：數據 → 分析 → 圖表說明 → 洞察 → 完整報告
```

**4. 自動洞察提取**
```
使用：動態提示鏈 (9️⃣)
流程：數據 → 判斷數據類型 → 動態選擇分析方法 → 洞察
```

#### 實作建議
- 📊 使用並行鏈大幅提升分析速度
- 🎯 數據清理步驟很重要，不可省略
- 📈 圖表說明可以用模型自動生成
- 💡 洞察提取使用動態提示鏈效果最好

---

## 🎯 Chain 類型選擇決策樹

```
你的需求是？
│
├─ 🤔 簡單的輸入→輸出
│  └─ 👉 使用「基礎鏈」(1️⃣)
│
├─ 🔧 需要自定義處理邏輯
│  │
│  ├─ 不需要調用模型
│  │  └─ 👉 使用「擴展鏈」(2️⃣)
│  │
│  └─ 需要動態調用模型
│     └─ 👉 使用「動態提示鏈」(9️⃣) ⭐
│
├─ ⚡ 需要同時處理多個任務
│  │
│  ├─ 任務不需要模型
│  │  └─ 👉 使用「並行鏈」(3️⃣)
│  │
│  └─ 任務需要多個模型分析
│     └─ 👉 使用「並行模型鏈」(8️⃣)
│
├─ 🔀 需要根據條件選擇路徑
│  └─ 👉 使用「分支鏈」(4️⃣)
│
├─ 🔄 需要多個步驟逐步處理
│  └─ 👉 使用「串聯模型鏈」(5️⃣)
│
└─ 🎓 需要深入理解底層機制
   └─ 👉 學習「內部運作」(6️⃣)
```

---

## 📝 學習測驗

完成學習後，測試你對 Chains 的掌握程度！

### 🎯 測驗內容
- **檔案**：[quiz_chains.md](quiz_chains.md)
- **題數**：10 題精選選擇題
- **涵蓋範圍**：
  - 基礎鏈 (LCEL 語法)
  - 內部運作 (RunnableSequence)
  - 擴展鏈 (RunnableLambda)
  - 並行鏈 (RunnableParallel)
  - 分支鏈 (RunnableBranch)
  - Lambda 模型整合
  - 實際應用場景

### 特色
- ✅ 每題都有詳細解析
- ✅ 附帶程式碼範例
- ✅ 標註對應章節
- ✅ 評分標準與學習建議

### 📊 評分標準
| 分數 | 等級 | 建議 |
|------|------|------|
| 9-10 題 | 🏆 精通 | 可以開始實戰專案 |
| 7-8 題 | ✅ 良好 | 建議複習錯誤題目 |
| 5-6 題 | ⚠️ 及格 | 需要加強練習 |
| 0-4 題 | ❌ 需加強 | 建議重新複習章節 |

---

## 🎯 實戰項目建議

### 初級項目（完成快速實戰路徑後）

1. **FAQ 智能問答系統**
   - 使用：基礎鏈 + 擴展鏈
   - 時間：1 天
   - 難度：⭐⭐

2. **商品評論分析工具**
   - 使用：並行鏈
   - 時間：1-2 天
   - 難度：⭐⭐⭐

3. **郵件自動回覆系統**
   - 使用：分支鏈 + 擴展鏈
   - 時間：2-3 天
   - 難度：⭐⭐⭐

### 進階項目（完成深度理解路徑後）

4. **多功能內容創作助手**
   - 使用：串聯模型鏈 + 動態提示鏈
   - 時間：3-5 天
   - 難度：⭐⭐⭐⭐

5. **智能客服完整系統**（擴展案例 1）
   - 使用：分支鏈 + 並行鏈 + Memory
   - 時間：5-7 天
   - 難度：⭐⭐⭐⭐

6. **企業級內容分析平台**（擴展案例 2）
   - 使用：並行模型鏈 + 動態提示鏈
   - 時間：1-2 週
   - 難度：⭐⭐⭐⭐⭐

---

## 🔗 相關文檔

- 📖 [Chain 類型完整指南](CHAINS_GUIDE.md) - 10 種 Chain 詳細說明
- 📚 [學習路徑建議](LEARNING_PATHS.md) - 選擇適合你的學習路線
- 🔧 [技術深入指南](TECHNICAL_GUIDE.md) - LCEL 和最佳實踐
- 📋 [總結與參考](SUMMARY.md) - 快速查詢表
- [返回主頁](README.md)
