# RAG - æª¢ç´¢å¢å¼·ç”Ÿæˆ
# Retrieval Augmented Generation

> ğŸ“– **é–±è®€æ™‚é–“**ï¼š10 åˆ†é˜ | ğŸ¯ **é©åˆå°è±¡**ï¼šAI é–‹ç™¼åˆå­¸è€…åˆ°é€²éšé–‹ç™¼è€…

## ğŸ“š ä»€éº¼æ˜¯ RAGï¼Ÿ

**RAG (Retrieval Augmented Generation)** æ˜¯ä¸€ç¨®çµåˆæª¢ç´¢ç³»çµ±èˆ‡ç”Ÿæˆå¼ AI çš„æŠ€è¡“ï¼Œè®“ LLM èƒ½å¤ å­˜å–å¤–éƒ¨çŸ¥è­˜åº«ä¾†ç”Ÿæˆæ›´æº–ç¢ºã€æ›´æœ‰æ ¹æ“šçš„å›ç­”ã€‚

å·¥ä½œæµç¨‹ï¼š
```
ä½¿ç”¨è€…å•é¡Œ â†’ å‘é‡æª¢ç´¢ â†’ ç›¸é—œæ–‡æª” â†’ LLM ç”Ÿæˆ â†’ æœ‰æ ¹æ“šçš„ç­”æ¡ˆ
```

**æ ¸å¿ƒå„ªå‹¢**ï¼š
- âœ… **çŸ¥è­˜æ›´æ–°**ï¼šç„¡éœ€é‡æ–°è¨“ç·´æ¨¡å‹å³å¯æ›´æ–°çŸ¥è­˜
- âœ… **æº–ç¢ºæ€§é«˜**ï¼šåŸºæ–¼å¯¦éš›æ–‡æª”ç”Ÿæˆç­”æ¡ˆ
- âœ… **å¯è¿½æº¯æ€§**ï¼šå¯ä»¥è¿½è¹¤è³‡è¨Šä¾†æº
- âœ… **æˆæœ¬æ•ˆç›Š**ï¼šæ¯”å¾®èª¿æ¨¡å‹æ›´ç¶“æ¿Ÿ

---

## [äº†è§£å‘é‡è³‡æ–™åº«å’ŒåµŒå…¥å¼æ¨¡å‹](./å‘é‡è³‡æ–™åº«èˆ‡åµŒå…¥æ¨¡å‹.md)

## ğŸ—ºï¸ RAG æ•™å­¸ç¯„ä¾‹é€Ÿè¦½

### ğŸ““ Jupyter Notebook äº’å‹•å¼æ•™å­¸ï¼ˆæ¨è–¦å­¸ç”Ÿä½¿ç”¨ï¼‰

| Notebook | é›£åº¦ | æ ¸å¿ƒå…§å®¹ | æª”æ¡ˆ | å­¸ç¿’ç›®æ¨™ |
|----------|------|----------|------|----------|
| 1. RAG åŸºç¤å…¥é–€ | â­ | å»ºç«‹ + æŸ¥è©¢ + Chain | [1_rag_basics.ipynb](1_rag_basics.ipynb) | ç†è§£å‘é‡è³‡æ–™åº«çš„å»ºç«‹èˆ‡æª¢ç´¢ |
| 2. å¤šæª”æ¡ˆèˆ‡å…ƒæ•¸æ“š | â­â­ | å¤šæª”æ¡ˆ + å…ƒæ•¸æ“š + Chain | [2_rag_basics_metadata.ipynb](2_rag_basics_metadata.ipynb) | å­¸ç¿’è™•ç†å¤šä¾†æºæ–‡ä»¶ |
| 3. æ–‡æœ¬åˆ†å‰²ç­–ç•¥ | â­â­â­ | 5ç¨®åˆ†å‰²ç­–ç•¥æ¯”è¼ƒ | [3_text_splitting.ipynb](3_text_splitting.ipynb) | ç†è§£åˆ†å‰²å°æª¢ç´¢çš„å½±éŸ¿ |
| 4. Embedding æ¨¡å‹æ¯”è¼ƒ | â­â­â­ | 4ç¨® Embedding æ¨¡å‹ | [4_embedding_comparison.ipynb](4_embedding_comparison.ipynb) | é¸æ“‡æœ€é©åˆçš„åµŒå…¥æ¨¡å‹ |
| 5. æª¢ç´¢å™¨ç­–ç•¥ | â­â­â­â­ | Similarityã€MMRã€Threshold | [5_retriever_strategies.ipynb](5_retriever_strategies.ipynb) | æŒæ¡é€²éšæª¢ç´¢æŠ€è¡“ |
| 6. å–®æ¬¡å•ç­”ç³»çµ± | â­â­â­â­ | æª¢ç´¢ + RAG Chain | [6_one_off_question.ipynb](6_one_off_question.ipynb) | å»ºç«‹å®Œæ•´å•ç­”ç³»çµ± |
| 7. å°è©±å¼ RAG | â­â­â­â­â­ | è¼‰å…¥ + å°è©±éˆ | [7_conversational_rag.ipynb](7_conversational_rag.ipynb) | å¯¦ä½œå¤šè¼ªå°è©±ç³»çµ± |
| 8. ç¶²é çˆ¬å– RAG | â­â­â­â­ | WebBaseLoader + RAG | [8_web_scraping.ipynb](8_web_scraping.ipynb) | æ•´åˆç¶²é å…§å®¹åˆ° RAG |

**æ¯å€‹ Notebook çš„çµæ§‹è¨­è¨ˆï¼š**
- ğŸ“¦ **ç¬¬1æ ¼**ï¼šå»ºç«‹/è¼‰å…¥å‘é‡è³‡æ–™åº«ï¼ˆè³‡æ–™æº–å‚™ï¼‰
- ğŸ” **ç¬¬2æ ¼**ï¼šæŸ¥è©¢èˆ‡æª¢ç´¢æ¼”ç¤ºï¼ˆç†è§£æª¢ç´¢æ©Ÿåˆ¶ï¼‰
- ğŸ”— **ç¬¬3æ ¼**ï¼šæ•´åˆ RAG Chainï¼ˆå¯¦éš›æ‡‰ç”¨ï¼Œéƒ¨åˆ† Notebook åŒ…å«ï¼‰

**æ‰€æœ‰ Notebook éƒ½æœ‰ï¼š**
- âœ… å®Œæ•´çš„ç¨‹å¼ç¢¼è¨»è§£
- âœ… æ¸…æ¥šçš„åŸ·è¡Œæ­¥é©Ÿèªªæ˜
- âœ… å¯¦ç”¨çš„ç¯„ä¾‹èˆ‡æç¤º
- âœ… ä½¿ç”¨ books/ ç›®éŒ„ä¸­çš„ç¹é«”ä¸­æ–‡çœŸå¯¦æƒ…å¢ƒè³‡æ–™

---

### ğŸ”§ é€²éš Python ç¯„ä¾‹ï¼ˆé¸å­¸ï¼‰

| ç¯„ä¾‹ | é›£åº¦ | æ ¸å¿ƒæŠ€è¡“ | æª”æ¡ˆ | ä¸»è¦ç”¨é€” |
|------|------|----------|------|----------|
| Firecrawl çˆ¬å– | â­â­â­â­ | Firecrawl API | [8_rag_web_scrape_firecrawl.py](8_rag_web_scrape_firecrawl.py) | é€²éšç¶²é çˆ¬å–èˆ‡å‹•æ…‹å…§å®¹è™•ç† |

ğŸ’¡ **èªªæ˜**: æ­¤ Python ç¯„ä¾‹å±•ç¤ºå¦‚ä½•ä½¿ç”¨ Firecrawl è™•ç†éœ€è¦ JavaScript æ¸²æŸ“çš„å‹•æ…‹ç¶²é ï¼Œæ˜¯ Notebook 8 çš„é€²éšæ“´å±•ã€‚

---

### ğŸ¯ å¯¦æˆ°æ¡ˆä¾‹ï¼ˆGradio ä»‹é¢ï¼‰

| æ¡ˆä¾‹ | é›£åº¦ | æ ¸å¿ƒæŠ€è¡“ | æª”æ¡ˆ | æ‡‰ç”¨å ´æ™¯ |
|------|------|----------|------|----------|
| æ¡ˆä¾‹ 1ï¼šæ™ºæ…§æ–‡æª”å•ç­”ç³»çµ± | â­â­â­â­ | Chroma + RAG Chain + Metadata éæ¿¾ | [case1_smart_document_qa_system.py](case1_smart_document_qa_system.py) | ä¼æ¥­çŸ¥è­˜åº«ã€å®¢æœç³»çµ±ã€æŠ€è¡“æ–‡æª”æŸ¥è©¢ |
| æ¡ˆä¾‹ 2ï¼šå¤šæ–‡æª”æ™ºèƒ½æ¯”è¼ƒç³»çµ± | â­â­â­â­â­ | ä¸¦è¡Œæª¢ç´¢ + RunnableParallel + RAG | [case2_document_comparison_system.py](case2_document_comparison_system.py) | ç”¢å“æ¯”è¼ƒã€åˆç´„åˆ†æã€æ”¿ç­–å°ç…§ |

**æ¡ˆä¾‹ç‰¹è‰²**ï¼š
- ğŸ–¥ï¸ **å®Œæ•´ Gradio ä»‹é¢**ï¼šå¯ç›´æ¥é‹è¡Œçš„ Web æ‡‰ç”¨
- ğŸ“š **ä½¿ç”¨çœŸå¯¦è³‡æ–™**ï¼šåŸºæ–¼ books/ è³‡æ–™å¤¾çš„ 8 æœ¬ä½¿ç”¨æ‰‹å†Š
- ğŸ¨ **å°ˆæ¥­è¨­è¨ˆ**ï¼šåŒ…å«ç¯„ä¾‹å•é¡Œã€é€²éšè¨­å®šã€çµæœæ ¼å¼åŒ–
- ğŸ’¡ **AI è¼”åŠ©æç¤º**ï¼šæ¯å€‹æ¡ˆä¾‹éƒ½é™„æœ‰ AI è¼”åŠ©é–‹ç™¼æç¤º
- ğŸ“– **è©³ç´°è¨»è§£**ï¼šå®Œæ•´çš„ç¨‹å¼ç¢¼èªªæ˜å’ŒæŠ€è¡“è§£æ

**é‹è¡Œæ–¹å¼**ï¼š
```bash
# å•Ÿç”¨ langchain ç’°å¢ƒ
## mac
source .venv/bash/activate

## window
.venv\Script\activate

# æ¡ˆä¾‹ 1ï¼šæ™ºæ…§æ–‡æª”å•ç­”ç³»çµ±ï¼ˆPort 7860ï¼‰
cd 4_rag
python case1_smart_document_qa_system.py

# æ¡ˆä¾‹ 2ï¼šå¤šæ–‡æª”æ™ºèƒ½æ¯”è¼ƒç³»çµ±ï¼ˆPort 7861ï¼‰
python case2_document_comparison_system.py
```

ğŸ“– **[å®Œæ•´æ¡ˆä¾‹ä½¿ç”¨èªªæ˜æ–‡æª”](RAG_å¯¦æˆ°æ¡ˆä¾‹ä½¿ç”¨èªªæ˜.md)**

---

### ğŸ“ å­¸ç¿’æ¸¬é©—

**[ğŸ“‹ RAG ç« ç¯€æ¸¬é©— - 10 é¡Œç²¾é¸](quiz_rag.md)**

æ¸¬é©—æ¶µè“‹ï¼š
- âœ… RAG åŸºç¤æ¦‚å¿µèˆ‡å„ªå‹¢
- âœ… å‘é‡è³‡æ–™åº«æ“ä½œï¼ˆChromaï¼‰
- âœ… Embedding æ¨¡å‹é¸æ“‡
- âœ… æ–‡æœ¬åˆ†å‰²ç­–ç•¥
- âœ… æª¢ç´¢ç­–ç•¥ï¼ˆSimilarityã€MMRã€Thresholdï¼‰
- âœ… Metadata éæ¿¾æ‡‰ç”¨
- âœ… RAG Chain æ¶æ§‹
- âœ… å°è©±å¼ RAG
- âœ… ç¶²é çˆ¬å–æ•´åˆ
- âœ… å¯¦éš›æ‡‰ç”¨å ´æ™¯åˆ†æ

**å­¸ç¿’å»ºè­°**ï¼š
1. å®Œæˆæ‰€æœ‰ Notebookï¼ˆ1-8ï¼‰å¾Œé€²è¡Œæ¸¬é©—
2. é‹è¡Œå…©å€‹å¯¦æˆ°æ¡ˆä¾‹ï¼Œç†è§£å¯¦éš›æ‡‰ç”¨
3. æ ¹æ“šæ¸¬é©—çµæœèª¿æ•´å­¸ç¿’é‡é»
4. åˆ†æ•¸ 7 åˆ†ä»¥ä¸‹å»ºè­°é‡æ–°è¤‡ç¿’ç›¸é—œç« ç¯€

---

## ğŸš€ 5 åˆ†é˜å¿«é€Ÿé–‹å§‹

### 1. ç’°å¢ƒè¨­å®š

```bash
# å®‰è£å¿…è¦å¥—ä»¶
pip install langchain langchain-community langchain-huggingface chromadb sentence-transformers

# è¨­å®šç’°å¢ƒè®Šæ•¸ï¼ˆå¦‚éœ€è¦ï¼‰
echo "HUGGINGFACE_API_KEY=your_api_key" > .env
```

### 2. å°‹æ‰¾é©åˆç¹é«”ä¸­æ–‡çš„åµŒå…¥æ¨¡å‹(embedding model)

#### æ¨¡å‹æ¯”è¼ƒ

**BAAI/bge-m3(BAAI åŒ—äº¬æ™ºæº)**
- åƒæ•¸é‡: ~569M (ç´„ 5.69 å„„)
- Embedding ç¶­åº¦: 1024
- æœ€å¤§åºåˆ—é•·åº¦: 8192 tokens
- èªè¨€æ”¯æ´: 100+ èªè¨€
- ç‰¹é»: BAAI (åŒ—äº¬æ™ºæº)é–‹ç™¼, SOTA å¤šèªè¨€æ¨¡å‹, æ”¯æ´é•·æ–‡æœ¬ (8K) ä¸”å…·å‚™å¤šåŠŸèƒ½ (ç¨ å¯†/ç¨€ç–) æª¢ç´¢
- åŸºç¤æ¶æ§‹(Base Architecture):XLM-RoBERTa
- åŸºç¤æ¶æ§‹é–‹ç™¼è€…: Meta (Facebook AI) 

**intfloat/multilingual-e5-large(Microsofté–‹ç™¼)**
- åƒæ•¸é‡: 560M (24å±¤)
- Embedding ç¶­åº¦: 1024
- æœ€å¤§åºåˆ—é•·åº¦: 512 tokens
- èªè¨€æ”¯æ´: 100+ èªè¨€
- ç‰¹é»: å¾®è»Ÿé–‹ç™¼,åœ¨å¤šèªè¨€åŸºæº–æ¸¬è©¦ä¸Šè¡¨ç¾å„ªç•°
- åŸºç¤æ¶æ§‹(Base Architecture):XLM-RoBERTa
- åŸºç¤æ¶æ§‹é–‹ç™¼è€…: Meta (Facebook AI)

**jinaai/jina-embeddings-v2-base-zh(BaseModel:Qwen3.0)**
- åƒæ•¸é‡: 161M (æ›´è¼•é‡)
- Embedding ç¶­åº¦: 768
- æœ€å¤§åºåˆ—é•·åº¦: **8192 tokens** â­
- èªè¨€æ”¯æ´: ä¸­è‹±é›™èªå°ˆé–€å„ªåŒ–
- ç‰¹é»: å°ˆé–€ç‚ºä¸­è‹±æ··åˆè¼¸å…¥è¨“ç·´,æ¸›å°‘èªè¨€åå·®
- é–‹ç™¼:é˜¿é‡Œå·´å·´

#### æ¨è–¦å»ºè­°2å€‹ç¹é«”ä¸­æ–‡

**æº–ç¢ºåº¦**
- **BAAI/bge-m3å¯¦æ¸¬æ™‚,æº–ç¢ºåº¦æœ€é«˜**
- **multilingual-e5-largeå¯¦æ¸¬æ™‚,æº–ç¢ºåº¦è¼ƒé«˜**
- **jina-embeddings-v2-base-zh å¯¦æ¸¬æ™‚,æº–ç¢ºåº¦ä¸€èˆ¬**


### ğŸš€ Embedding æ¨¡å‹é¸æ“‡æŒ‡å—ï¼šBGE-m3 vs. Jina-v2 vs. E5

ç¹é«”ä¸­æ–‡ã€è‹±æ–‡ã€æ—¥æ–‡ æ··åˆèªè¨€ä»»å‹™é¸æ“‡ Embedding æ¨¡å‹æ™‚ï¼Œæ•ˆèƒ½ã€æ–‡æœ¬é•·åº¦å’Œéƒ¨ç½²æˆæœ¬æ˜¯é—œéµã€‚

#### å¿«é€Ÿæ¯”è¼ƒè¡¨

| ç‰¹æ€§ | `BAAI/bge-m3` (é¦–é¸) | `jina-embeddings-v2-base-zh` (è¼•é‡é¦–é¸) | `intfloat/multilingual-e5-large` (èˆŠ) |
| :--- | :--- | :--- | :--- |
| **å¤šèªè¨€æ€§èƒ½** | ğŸ¥‡ **é ‚å°– (SOTA)** | ğŸ¥ˆ å„ªç§€ (å°ˆç²¾ä¸­è‹±) | ğŸ¥‰ è‰¯å¥½ (èˆŠ SOTA) |
| **æœ€å¤§é•·åº¦** | **8192 tokens** | **8192 tokens** | 512 tokens |
| **åƒæ•¸é‡** | ~569M (å¤§å‹) | **~161M (è¼•é‡ç´š)** | ~560M (å¤§å‹) |
| **Embedding ç¶­åº¦**| 1024 | 768 | 1024 |
| **æ ¸å¿ƒå„ªå‹¢** | ç²¾åº¦æœ€é«˜ã€é•·æ–‡æœ¬ã€å¤šåŠŸèƒ½ | é€Ÿåº¦æœ€å¿«ã€é•·æ–‡æœ¬ã€ä¸­è‹±å„ªåŒ– | å¤šèªè¨€æ”¯æ´ |
| **ä¸»è¦ç¼ºé»** | æ¨¡å‹é«”ç©å¤§ | å¤šèªè¨€æ³›ç”¨æ€§(éä¸­è‹±)ç¨å¼± | **åƒ…æ”¯æ´çŸ­æ–‡æœ¬ (512)** |

---

### ğŸ’¡ æƒ…å¢ƒåˆ†æèˆ‡å»ºè­°

#### 1. é¸æ“‡ `BAAI/bge-m3` çš„æƒ…æ³ (è¿½æ±‚æœ€å¼·æ€§èƒ½)

`bge-m3` æ˜¯ç›®å‰å…¬èªæœ€å¼·çš„**é–‹æºå¤šèªè¨€**æ¨¡å‹ï¼Œå®ƒå¹¾ä¹çµåˆäº†å¦å¤–å…©è€…çš„æ‰€æœ‰å„ªé»ã€‚

* **SOTA å¤šèªè¨€æ€§èƒ½**ï¼šåœ¨ MTEB ç­‰å¤šèªè¨€åŸºæº–æ¸¬è©¦ä¸Šå…¨é¢é ˜å…ˆï¼Œæ”¯æ´ 100+ èªè¨€ï¼Œè™•ç†ç¹ä¸­ã€æ—¥æ–‡ã€è‹±æ–‡æ··åˆçš„ç²¾åº¦æœ€é«˜ã€‚
* **é•·æ–‡æœ¬æ”¯æ´ (8K)**ï¼šèˆ‡ Jina åŒç´šï¼Œé”åˆ° **8192 tokens**ï¼Œé©åˆè™•ç†é•·æ–‡æª”ã€æ³•å¾‹æ–‡ä»¶æˆ–æŠ€è¡“æ‰‹å†Šã€‚
* **å¤šåŠŸèƒ½æ€§**ï¼šä¸åƒ…æ”¯æ´ç¨ å¯†æª¢ç´¢ (Dense)ï¼Œé‚„æ”¯æ´ç¨€ç– (Sparse) å’Œå¤šå‘é‡ (ColBERT) æª¢ç´¢ï¼ŒåŠŸèƒ½æœ€å…¨é¢ã€‚
* **æ¨¡å‹é«”ç©**ï¼šèˆ‡ E5 å±¬æ–¼åŒä¸€å€‹ã€Œå¤§å‹ã€ç´šåˆ¥ (~569M åƒæ•¸)ï¼Œéƒ¨ç½²æˆæœ¬é«˜æ–¼ Jinaã€‚

> **çµè«–ï¼š** å¦‚æœæ‚¨çš„ç¡¬é«”è³‡æºå…è¨±ï¼Œä¸”è¿½æ±‚**æœ€ä½³çš„å¤šèªè¨€æ··åˆç²¾åº¦**èˆ‡**é•·æ–‡æª”è™•ç†èƒ½åŠ›**ï¼Œ`bge-m3` æ˜¯ 2024-2025 å¹´çš„é¦–é¸ã€‚

#### 2. é¸æ“‡ `jina-embeddings-v2-base-zh` çš„æƒ…æ³ (è¿½æ±‚æ•ˆç‡èˆ‡ä¸­è‹±)

Jina æ‰¾åˆ°äº†æ•ˆèƒ½èˆ‡æ•ˆç‡çš„æœ€ä½³å¹³è¡¡é»ï¼Œç‰¹åˆ¥é©åˆä¸­è‹±æ··åˆå ´æ™¯ã€‚

* **è¼•é‡é«˜æ•ˆ (161M)**ï¼šæ¨¡å‹åƒæ•¸é‡åƒ…ç´„ 161M (ç›¸è¼ƒæ–¼ bge-m3 å’Œ E5 çš„ ~560M)ï¼Œæ¨ç†é€Ÿåº¦å¿«éå¸¸å¤šï¼Œéƒ¨ç½²æˆæœ¬é¡¯è‘—é™ä½ã€‚
* **é•·æ–‡æœ¬æ”¯æ´ (8K)**ï¼šåŒæ¨£æ”¯æ´ **8192 tokens**ï¼Œåœ¨è¼•é‡ç´šæ¨¡å‹ä¸­æ¥µç‚ºç½•è¦‹ã€‚
* **ä¸­è‹±æ··åˆå„ªåŒ–**ï¼šå°ˆç‚ºä¸­è‹±æ··åˆè¼¸å…¥è¨“ç·´ï¼Œåœ¨ä¸­æ–‡ç›¸é—œä»»å‹™ä¸Šçš„è¡¨ç¾å„ªæ–¼ E5 Multilingualï¼Œéå¸¸é©åˆå°ç£çš„ç¹é«”ä¸­æ–‡ä½¿ç”¨å ´æ™¯ã€‚

> **çµè«–ï¼š** å¦‚æœæ‚¨çš„æ‡‰ç”¨**é«˜åº¦å°ˆæ³¨æ–¼ä¸­è‹±æ··åˆ**ï¼Œä¸”**æ¨ç†é€Ÿåº¦**ã€**éƒ¨ç½²æˆæœ¬**æ˜¯é‡è¦è€ƒé‡ï¼ŒJina v2 æ˜¯å…¼å…·é•·æ–‡æœ¬èƒ½åŠ›çš„æœ€ä½³é¸æ“‡ã€‚

#### 3. é¸æ“‡ `multilingual-e5-large` çš„æƒ…æ³ (èˆŠå°ˆæ¡ˆæˆ–çŸ­æ–‡æœ¬)

E5 æ›¾æ˜¯ SOTAï¼Œä½†åœ¨ç•¶å‰å·²è¢«è¶…è¶Šï¼Œå…¶æœ€å¤§çš„é™åˆ¶åœ¨æ–¼æ–‡æœ¬é•·åº¦ã€‚

* **å¤šèªè¨€æ”¯æ´**ï¼šæ”¯æ´ 100+ èªè¨€ï¼Œæ˜¯æˆç†Ÿçš„å¤šèªè¨€æ¨¡å‹ã€‚
* **ä¸»è¦é™åˆ¶ (512 tokens)**ï¼šæœ€å¤§åºåˆ—é•·åº¦**åƒ… 512 tokens**ã€‚åœ¨ RAG æ‡‰ç”¨ä¸­ï¼Œé€™æ„å‘³è‘—æ‚¨å¿…é ˆå°‡æ‰€æœ‰æ–‡ä»¶åˆ‡å¾—éå¸¸ç¢ï¼Œå¯èƒ½å°è‡´èªç¾©æµå¤±ï¼Œä¸é©åˆè™•ç†é•·æ–‡æª”ã€‚
* **æ€§èƒ½**ï¼šå·²è¢« `bge-m3` å…¨é¢è¶…è¶Šã€‚

> **çµè«–ï¼š** é™¤éæ˜¯ç¶­è­·èˆŠå°ˆæ¡ˆï¼Œæˆ–æ‚¨çš„ä»»å‹™ 100% ç¢ºå®š**åªæœƒè™•ç†çŸ­å¥æˆ–æ¨™é¡Œ** (ä¾‹å¦‚ï¼šçŸ­å¥ç›¸ä¼¼åº¦æ¯”å°)ï¼Œå¦å‰‡**ä¸å»ºè­°**åœ¨æ–°å°ˆæ¡ˆä¸­é¸ç”¨ã€‚



**ä½¿ç”¨ç¯„ä¾‹:**

```python
from sentence_transformers import SentenceTransformer

model = SentenceTransformer(
    "jinaai/jina-embeddings-v2-base-zh",
    trust_remote_code=True
)
model.max_seq_length = 8192  # å¯èª¿æ•´

embeddings = model.encode([
    'é€™æ˜¯ä¸€æ®µç¹é«”ä¸­æ–‡æ¸¬è©¦',
    'This is an English test'
])
```


### 2. ç¬¬ä¸€å€‹ RAG ç³»çµ±
```python
from langchain_community.document_loaders import TextLoader
from langchain_text_splitters import CharacterTextSplitter
from langchain_community.vectorstores import Chroma
from langchain_community.embeddings import HuggingFaceEmbeddings
import os
from pathlib import Path


# è¼‰å…¥æ–‡æª”
loader = TextLoader("books/æ™ºæ…§å‹æ‰‹æ©Ÿä½¿ç”¨æ‰‹å†Š.txt")
documents = loader.load()

# åˆ†å‰²æ–‡æª”
# chunk_size=1000: æ¯å€‹æ–‡æœ¬å€å¡Šæœ€å¤š 1000 å€‹å­—å…ƒï¼Œé¿å…è¶…éæ¨¡å‹é™åˆ¶
# chunk_overlap=200: å€å¡Šä¹‹é–“é‡ç–Š 200 å€‹å­—å…ƒï¼Œé˜²æ­¢é‡è¦è³‡è¨Šåœ¨åˆ†å‰²æ™‚è¢«åˆ‡æ–·
text_spliter = CharacterTextSplitter(chunk_size=1000, chunk_overlap=200)
docs = text_spliter.split_documents(documents)

# ä½¿ç”¨ HuggingFace çš„ä¸­æ–‡ embedding æ¨¡å‹
embeddings = HuggingFaceEmbeddings(
    model_name = 'jinaai/jina-embeddings-v2-base-zh'
)

# è¨­å®šå‘é‡è³‡æ–™åº«è·¯å¾‘ï¼ˆä½¿ç”¨çµ•å°è·¯å¾‘é¿å…æ¬Šé™å•é¡Œï¼‰
db_path = os.path.abspath("./db/mobile")

# æª¢æŸ¥è³‡æ–™åº«æ˜¯å¦å·²å­˜åœ¨ï¼Œé¿å…æ¯æ¬¡éƒ½é‡å»º
if Path(db_path).exists():
    # è³‡æ–™åº«å·²å­˜åœ¨ï¼Œç›´æ¥è¼‰å…¥
    db = Chroma(persist_directory=db_path, embedding_function=embeddings)
    print("è¼‰å…¥ç¾æœ‰è³‡æ–™åº«")
else:
    # è³‡æ–™åº«ä¸å­˜åœ¨ï¼Œå»ºç«‹æ–°çš„å‘é‡è³‡æ–™åº«
    db = Chroma.from_documents(docs, embeddings, persist_directory=db_path)
    print("å»ºç«‹æ–°è³‡æ–™åº«")

# æŸ¥è©¢èˆ‡ã€Œç›¸æ©ŸåŠŸèƒ½ã€æœ€ç›¸ä¼¼çš„ 3 å€‹æ–‡æœ¬å€å¡Š
results = db.similarity_search("ç›¸æ©ŸåŠŸèƒ½", k=3)
print(results)
```

### 3. ç†è§£ RAG é—œéµçµ„ä»¶
```python
# æ–‡æª”è¼‰å…¥å™¨ (Document Loader)
loader = TextLoader("file.txt")  # æ”¯æ´å¤šç¨®æ ¼å¼

# æ–‡æœ¬åˆ†å‰²å™¨ (Text Splitter)
splitter = CharacterTextSplitter(chunk_size=1000, chunk_overlap=100)

# åµŒå…¥æ¨¡å‹ (Embedding Model)
embeddings = HuggingFaceEmbeddings(model_name="model-name")

# å‘é‡å­˜å„² (Vector Store)
db = Chroma.from_documents(docs, embeddings)

# æª¢ç´¢å™¨ (Retriever)
retriever = db.as_retriever(search_type="similarity", search_kwargs={"k": 3})
```

---


## â“ å¸¸è¦‹å•é¡Œé€Ÿç­”

### Q1: ä»€éº¼æ™‚å€™ä½¿ç”¨ RAGï¼Ÿ
ç•¶ä½ éœ€è¦ LLM å›ç­”ç‰¹å®šé ˜åŸŸçŸ¥è­˜æˆ–æœ€æ–°è³‡è¨Šæ™‚

### Q2: RAG å’Œå¾®èª¿(Fine-tuning)çš„å·®åˆ¥ï¼Ÿ
- **RAG**ï¼šå‹•æ…‹æª¢ç´¢å¤–éƒ¨çŸ¥è­˜ï¼Œæ˜“æ–¼æ›´æ–°
- **å¾®èª¿**ï¼šå°‡çŸ¥è­˜å›ºåŒ–åˆ°æ¨¡å‹ä¸­ï¼Œæ›´æ–°æˆæœ¬é«˜

### Q3: å¦‚ä½•é¸æ“‡ Embedding æ¨¡å‹ï¼Ÿ
- ä¸­æ–‡å…§å®¹ï¼šæ¨è–¦ `jinaai/jina-embeddings-v2-base-zh`
- å¤šèªè¨€å’Œä¸­æ–‡å…§å®¹ï¼šæ¨è–¦ `intfloat/multilingual-e5-large`
- æ•ˆèƒ½å„ªå…ˆï¼šOpenAI `text-embedding-3-small`

### Q4: å¦‚ä½•å„ªåŒ–æª¢ç´¢æ•ˆæœï¼Ÿ
1. èª¿æ•´ `chunk_size` å’Œ `chunk_overlap`
2. ä½¿ç”¨åˆé©çš„æª¢ç´¢ç­–ç•¥ï¼ˆsimilarityã€MMRï¼‰
3. æ·»åŠ å…ƒæ•¸æ“šéæ¿¾
4. èª¿æ•´ `k` å€¼ï¼ˆè¿”å›çµæœæ•¸é‡ï¼‰

### Q5: Chroma è³‡æ–™å¦‚ä½•æŒä¹…åŒ–ï¼Ÿ
```python
# æŒä¹…åŒ–åˆ°æœ¬æ©Ÿ
db = Chroma.from_documents(
    docs,
    embeddings,
    persist_directory="./chroma_db"
)

# è¼‰å…¥å·²å­˜åœ¨çš„è³‡æ–™åº«
db = Chroma(
    persist_directory="./chroma_db",
    embedding_function=embeddings
)
```

---

## ğŸ“¦ è³‡æºèˆ‡æ•¸æ“š

### books/ ç›®éŒ„
åŒ…å«æ•™å­¸ç”¨çš„ç¹é«”ä¸­æ–‡ä½¿ç”¨æ‰‹å†Šæ–‡æœ¬ï¼š
- å®¶é›»é¡ï¼šæ™ºæ…§å‹æ‰‹æ©Ÿä½¿ç”¨æ‰‹å†Šã€æ´—è¡£æ©Ÿä½¿ç”¨èªªæ˜ã€å†·æ°£æ©Ÿå®‰è£ç¶­è­·æ‰‹å†Šã€è·¯ç”±å™¨è¨­å®šæ‰‹å†Š
- äº¤é€šé¡ï¼šé›»å‹•æ©Ÿè»Šä½¿ç”¨æ‰‹å†Š
- ç”Ÿæ´»é¡ï¼šä¿¡ç”¨å¡æ¬Šç›Šèªªæ˜ã€å¥ä¿å°±é†«æŒ‡å—ã€ç§Ÿå±‹å¥‘ç´„ç¯„æœ¬èˆ‡èªªæ˜

### db/ ç›®éŒ„
è‡ªå‹•ç”Ÿæˆçš„å‘é‡è³‡æ–™åº«å­˜å„²ä½ç½®ï¼ˆåŸ·è¡Œç¯„ä¾‹å¾Œæœƒè‡ªå‹•å»ºç«‹ï¼‰

---

## ğŸ¯ å­¸ç¿’è·¯å¾‘å»ºè­°

### ğŸ“ åˆå­¸è€…è·¯ç·šï¼ˆæ¨è–¦ä½¿ç”¨ Jupyter Notebookï¼‰

**Step 1: åŸºç¤å…¥é–€ (å¿…å­¸)**

1. ğŸ““ [1_rag_basics.ipynb](1_rag_basics.ipynb) - ç†è§£å‘é‡è³‡æ–™åº«åŸºæœ¬æ¦‚å¿µ
2. ğŸ““ [2_rag_basics_metadata.ipynb](2_rag_basics_metadata.ipynb) - å­¸ç¿’è™•ç†å¤šæª”æ¡ˆ
3. ğŸ““ [3_text_splitting.ipynb](3_text_splitting.ipynb) - ç†è§£æ–‡æœ¬åˆ†å‰²ç­–ç•¥

**Step 2: å¯¦ç”¨æ‡‰ç”¨**

4. ğŸ““ [6_one_off_question.ipynb](6_one_off_question.ipynb) - å»ºç«‹ç¬¬ä¸€å€‹å•ç­”ç³»çµ±
5. ğŸ““ [7_conversational_rag.ipynb](7_conversational_rag.ipynb) - å°è©±å¼ RAG ç³»çµ±

**Step 3: é€²éšå­¸ç¿’ (é¸å­¸)**

7. ğŸ““ [4_embedding_comparison.ipynb](4_embedding_comparison.ipynb) - æ¯”è¼ƒä¸åŒ Embedding æ¨¡å‹
8. ğŸ““ [5_retriever_strategies.ipynb](5_retriever_strategies.ipynb) - å­¸ç¿’æª¢ç´¢ç­–ç•¥
9. ğŸ““ [8_web_scraping.ipynb](8_web_scraping.ipynb) - ç¶²é å…§å®¹æ•´åˆ

**å­¸ç¿’æ™‚é–“**: ç´„ 4-6 å°æ™‚

---

### ğŸš€ é€²éšé–‹ç™¼è€…è·¯ç·š

**Notebook å®Œæ•´å­¸ç¿’**

1. ğŸ““ ä¾åºå®Œæˆ 1-8 æ‰€æœ‰ Notebook
2. ğŸ““ æ·±å…¥ç†è§£æ¯å€‹ Notebook çš„ç¨‹å¼ç¢¼å¯¦ä½œ
3. ğŸ““ é‡é»å­¸ç¿’ [7_conversational_rag.ipynb](7_conversational_rag.ipynb) - å¯¦ä½œå°è©±ç³»çµ±

**é€²éšæ“´å±•**

4. ğŸ ç ”ç©¶ `8_rag_web_scrape_firecrawl.py` - å‹•æ…‹ç¶²é çˆ¬å–
5. ğŸ”¨ å°‡ Notebook ç¯„ä¾‹æ”¹å¯«ç‚ºç”Ÿç”¢ç’°å¢ƒçš„ Python æ¨¡çµ„
6. ğŸ“¦ æ•´åˆåˆ°è‡ªå·±çš„å°ˆæ¡ˆä¸­

**å­¸ç¿’æ™‚é–“**: ç´„ 6-10 å°æ™‚

---

### ğŸ’¼ å¯¦æˆ°å°ˆæ¡ˆè·¯ç·š

**æ‡‰ç”¨ Notebook 1-8 å»ºç«‹è‡ªå·±çš„ RAG ç³»çµ±**

1. **æ–‡æª”å•ç­”ç³»çµ±** - ä½¿ç”¨ Notebook 1-6 å»ºç«‹å…¬å¸å…§éƒ¨æ–‡æª”æŸ¥è©¢ç³»çµ±
2. **çŸ¥è­˜åº«æ©Ÿå™¨äºº** - ä½¿ç”¨ Notebook 7 å»ºç«‹å¤šè¼ªå°è©±çŸ¥è­˜åŠ©æ‰‹
3. **ç¶²é å…§å®¹åˆ†æ** - ä½¿ç”¨ Notebook 8 + Firecrawl çˆ¬å–ä¸¦åˆ†æç¶²é å…§å®¹
4. **å¤šæ¨¡å‹æ¯”è¼ƒ** - ä½¿ç”¨ Notebook 4 æ¯”è¼ƒä¸åŒ Embedding æ¨¡å‹æ•ˆæœ
5. **è‡ªè¨‚é ˜åŸŸ RAG** - æ•´åˆåˆ°è‡ªå·±çš„å°ˆæ¡ˆä¸­

**å­¸ç¿’æ™‚é–“**: ç´„ 8-12 å°æ™‚

**å°ˆæ¡ˆå»ºè­°**:
- ä½¿ç”¨ Notebook 1-8 ä½œç‚ºåŸºç¤ç¯„æœ¬
- æ ¹æ“šéœ€æ±‚é¸æ“‡åˆé©çš„ Embedding æ¨¡å‹(Notebook 4)å’Œæª¢ç´¢ç­–ç•¥(Notebook 5)
- å¾ç°¡å–®çš„å–®æ¬¡å•ç­”(Notebook 6)é–‹å§‹,é€æ­¥æ“´å±•åˆ°å°è©±å¼ç³»çµ±(Notebook 7)
- å–„ç”¨ books/ è³‡æ–™å¤¾çš„ç¯„ä¾‹æ–‡æœ¬é€²è¡Œæ¸¬è©¦

---

### ğŸ“š å­¸ç¿’å»ºè­°

- âœ… **å„ªå…ˆä½¿ç”¨ Jupyter Notebook** - æ‰€æœ‰æ ¸å¿ƒæ¦‚å¿µéƒ½å·²æ¶µè“‹(1-8)
- âœ… **äº’å‹•å¼å­¸ç¿’** - æ¯å€‹ Notebook éƒ½å¯ä»¥é‚Šå­¸é‚ŠåŸ·è¡Œ,ç«‹å³çœ‹åˆ°çµæœ
- âœ… **å¾ªåºæ¼¸é€²** - æŒ‰ç…§ç·¨è™Ÿé †åºå­¸ç¿’,å¾åŸºç¤åˆ°é€²éš
- âœ… **å¯¦ä½œå„ªå…ˆ** - å…ˆå‹•æ‰‹åš,å†æ·±å…¥ç†è§£åŸç†
- âœ… **Firecrawl é¸å­¸** - å¦‚éœ€è™•ç†å‹•æ…‹ç¶²é ,å¯åƒè€ƒé€²éš Python ç¯„ä¾‹

---

## ğŸ”— ç›¸é—œè³‡æº

- [LangChain å®˜æ–¹æ–‡æª”](https://python.langchain.com/docs/use_cases/question_answering/)
- [Chroma å®˜æ–¹æ–‡æª”](https://docs.trychroma.com/)
- [HuggingFace Embeddings](https://huggingface.co/models?pipeline_tag=sentence-similarity)

---

## ğŸ’¡ æç¤º

- é¦–æ¬¡åŸ·è¡Œç¯„ä¾‹æ™‚æœƒä¸‹è¼‰ Embedding æ¨¡å‹ï¼Œå¯èƒ½éœ€è¦è¼ƒé•·æ™‚é–“
- å»ºè­°ä½¿ç”¨ GPU åŠ é€Ÿ Embedding è¨ˆç®—ï¼ˆç‰¹åˆ¥æ˜¯è™•ç†å¤§é‡æ•¸æ“šæ™‚ï¼‰
- å‘é‡è³‡æ–™åº«å»ºç«‹å¾Œå¯é‡è¤‡ä½¿ç”¨ï¼Œç„¡éœ€æ¯æ¬¡é‡æ–°å»ºç«‹
- å¯¦éš›æ‡‰ç”¨ä¸­å»ºè­°æ·»åŠ éŒ¯èª¤è™•ç†å’Œæ—¥èªŒè¨˜éŒ„
