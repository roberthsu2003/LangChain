# 向量資料庫與嵌入模型
> 用最簡單的方式理解 RAG 的核心技術

## 🗄️ 向量資料庫 (Vector Database)

### 什麼是向量資料庫？用生活例子說明

想像你在圖書館找書，傳統方式是查書名或作者（**關鍵字搜尋**）。但向量資料庫就像一個「聰明的圖書館員」，它能理解你的意思：

- 👤 你問：「我想找關於如何煮咖啡的書」
- 🤖 向量資料庫：找到所有「咖啡製作」、「沖泡技巧」、「咖啡豆研磨」等相關內容
- ✨ 即使這些書名裡沒有「煮咖啡」這個詞，它也能找到！

**簡單來說**：向量資料庫能理解「意思相近」的內容，而不只是找「字一樣」的東西。

### 它怎麼做到的？

1. 把所有文字轉換成「數字陣列」（向量）
2. 意思相近的內容，數字也會相近
3. 搜尋時比較數字的相似度
4. 找出最相關的內容

### 主要特點（用白話文說）

- **處理複雜資料**：可以把文字、圖片都轉成數字來比較
- **找相似內容**：不是找「字一樣」，而是找「意思像」
- **速度很快**：即使有上百萬筆資料，也能快速找到相關內容
- **越用越聰明**：可以不斷加入新資料，更新知識庫

### 常見的向量資料庫（初學者推薦）

| 名稱 | 特色 | 適合誰用 |
|------|------|----------|
| **Chroma** ⭐ | 最簡單！本地就能用 | 初學者、小專案 |
| **Pinecone** | 雲端服務，不用自己管理 | 需要大量資料的商業應用 |
| **Weaviate** | 功能強大，開源免費 | 進階開發者 |
| **FAISS** | Facebook 出品，超快速 | 需要高效能的專案 |

💡 **建議**：剛開始學習用 **Chroma** 就好，因為：
- 安裝簡單（一行指令搞定）
- 不需要架設伺服器
- 適合練習和小型專案
- 本課程所有範例都使用 Chroma

### 生活中的應用例子

| 應用 | 說明 | 生活例子 |
|------|------|----------|
| **智慧搜尋** | 理解問題的意思來搜尋 | Google 搜尋「如何修理漏水水龍頭」，找到相關維修影片 |
| **商品推薦** | 找相似的產品 | 看了一雙球鞋後，推薦類似風格的鞋款 |
| **客服機器人** | 回答客戶問題 | 問「怎麼退貨」，找到退貨流程說明來回答 |
| **以圖找圖** | 上傳圖片找相似圖片 | 拍一張沙發照片，找到類似款式的家具 |
| **文件查詢** | 在大量文件中找答案 | 在公司手冊中搜尋「請假流程」 |

---

## 🧠 嵌入模型 (Embedding Model)

### 什麼是嵌入模型？用翻譯機來比喻

**嵌入模型就像是一台「意思翻譯機」**，它的工作是：

```
輸入：人類的文字
↓
嵌入模型處理
↓
輸出：電腦能理解的數字（向量）
```

### 舉個實際例子

假設我們有三句話：

```
1. 「我喜歡吃蘋果」
2. 「蘋果很好吃」
3. 「今天天氣很好」
```

嵌入模型會把它們轉換成數字：

```
1. [0.8, 0.9, 0.1, 0.2, ...]  ← 關於吃水果
2. [0.7, 0.8, 0.2, 0.1, ...]  ← 也是關於吃水果（數字很接近！）
3. [0.1, 0.2, 0.9, 0.8, ...]  ← 關於天氣（數字很不一樣！）
```

👉 意思相近的句子，轉換出來的數字也會相近！

### 工作流程（簡化版）

```
📝 輸入文字
    ↓
🤖 AI 模型理解意思
    ↓
🔢 轉換成數字陣列
    ↓
💾 存入向量資料庫
```

### 常見的嵌入模型（分類整理）

#### 🌟 初學者推薦（免費開源）

| 模型名稱 | 特點 | 適合情境 |
|---------|------|----------|
| **Jina Embeddings v2** ⭐⭐⭐ | 專為繁體中文優化 | 處理中文內容（本課程使用） |
| **all-MiniLM-L6-v2** | 體積小、速度快 | 英文內容、資源有限 |
| **multilingual-e5-large** | 支援多種語言 | 需要處理多國語言 |

#### 💰 商業付費（更準確但要付費）

| 模型名稱 | 提供者 | 特點 |
|---------|--------|------|
| **text-embedding-3-small** | OpenAI | 效果好、速度快 |
| **text-embedding-3-large** | OpenAI | 最精準但較貴 |

#### 📷 處理圖片用

- **CLIP**：可以同時理解文字和圖片
- 例：輸入「海邊的日落」，能找到相關圖片

### 嵌入模型的魔法特性

| 特性 | 白話文說明 | 例子 |
|------|-----------|------|
| **理解意思** | 不只看字，還看懂意思 | 「汽車」和「轎車」會被認為很相近 |
| **長短統一** | 不管輸入多長，輸出固定 | 一句話和一整篇文章，都轉成相同長度的數字 |
| **可以比較** | 轉換後的數字可以互相比較 | 算出「咖啡」和「茶」的相似度 |
| **跨語言** | 不同語言也能比較 | 中文「你好」和英文「Hello」會被識別為相近 |

### 如何選擇嵌入模型？（決策樹）

```
開始
  ↓
主要處理中文？
  ├─ 是 → 用 Jina Embeddings v2 ⭐
  └─ 否 → 處理多種語言？
           ├─ 是 → 用 multilingual-e5-large
           └─ 否 → 只處理英文？
                    ├─ 是 → 用 all-MiniLM-L6-v2（快）
                    └─ 否 → 需要最高準確度？
                             ├─ 是 → OpenAI（要付費）
                             └─ 否 → all-mpnet-base-v2（平衡）
```

### 選擇時要考慮的因素（排優先順序）

1. **語言支援** 🌍
   - ✅ 處理中文？→ 選中文專用模型
   - ✅ 多國語言？→ 選多語言模型

2. **準確度 vs 成本** 💰
   - 免費開源：Jina、MiniLM（適合學習和小專案）
   - 付費 API：OpenAI（適合商業產品）

3. **速度和資源** ⚡
   - 體積小 = 速度快但可能不夠準
   - 體積大 = 更準確但需要更多資源

4. **文件長度** 📄
   - Jina v2：可處理超長文件（8192 tokens）
   - 其他模型：通常只能處理 512 tokens

💡 **新手建議**：先用 **Jina Embeddings v2**（如果是中文）或 **all-MiniLM-L6-v2**（如果是英文），等熟悉後再嘗試其他模型。

---

## 🔄 它們怎麼一起工作？（完整流程圖解）

### 建立知識庫（準備階段）

```
📚 原始文件（例：智慧型手機使用手冊）
    ↓
✂️ 分割成小段落
    「第一章：開機設定...」
    「第二章：相機功能...」
    「第三章：電池保養...」
    ↓
🧠 嵌入模型處理
    段落 1 → [0.2, 0.8, 0.1, ...]
    段落 2 → [0.7, 0.3, 0.9, ...]
    段落 3 → [0.1, 0.4, 0.6, ...]
    ↓
💾 存入向量資料庫
    等待使用者查詢
```

### 使用者查詢（使用階段）

```
👤 使用者問題
    「手機電池如何保養？」
    ↓
🧠 嵌入模型處理問題
    問題 → [0.1, 0.5, 0.7, ...]
    ↓
🔍 向量資料庫搜尋
    比對所有段落，找最相似的
    ↓
📄 找到相關段落
    「第三章：電池保養...」（最相似！）
    ↓
🤖 AI 根據找到的內容回答
    「手機電池保養方法：1. 避免完全放電...」
```

### 用生活例子說明整個過程

想像你是圖書館管理員（向量資料庫）：

1. **整理書籍**（建立索引）
   - 把每本書貼上便利貼，寫下重點（嵌入向量）
   - 相似主題的書，便利貼內容會很像

2. **讀者詢問**（查詢）
   - 讀者：「我想學咖啡拉花」
   - 你在心裡也寫一張便利貼（問題的嵌入向量）

3. **找書**（相似度搜尋）
   - 比對便利貼內容
   - 找到「咖啡製作」、「拉花技巧」等相關書籍

4. **回答**（返回結果）
   - 把找到的書交給讀者
   - 或直接告訴讀者答案（RAG）

### RAG 系統運作（用對話方式理解）

**建立知識庫階段：**
```
👨‍💻 開發者：把公司的產品手冊全部掃描進系統
🤖 系統：好的，我把每一頁都記下來了（存成向量）
```

**使用階段：**
```
👤 客戶：「你們的產品保固多久？」
🤖 系統：讓我找找看...（在向量資料庫搜尋）
📄 系統：找到了！在第15頁有提到保固
🤖 AI：「我們的產品提供兩年保固，保固期內...」
```

### 最佳實踐（白話版）

| 建議 | 說明 | 比喻 |
|------|------|------|
| **模型要一致** | 建立和查詢用同一個模型 | 用同一把尺來量身高，才能比較 |
| **適當分段** | 文件不要切太大或太小 | 字典按照每個字切，報紙按照每篇文章切 |
| **加上標籤** | 記錄來源、日期等資訊 | 照片要寫上拍攝地點和時間 |
| **定期更新** | 資料變更要更新資料庫 | 電話簿要隨時更新才不會打錯 |
| **測試品質** | 定期檢查回答是否正確 | 考試測驗學習成果 |

---

## 🎯 常見問題解答

### Q1: 為什麼需要向量資料庫？用一般資料庫不行嗎？

**A:** 一般資料庫只能找「字完全一樣」的內容：
- ❌ 搜尋「汽車」→ 找不到「轎車」、「車輛」
- ✅ 向量資料庫能找到「意思相近」的內容

### Q2: 向量到底是什麼？

**A:** 就是一串數字，像這樣：`[0.2, 0.8, 0.5, 0.1, ...]`
- 這些數字代表文字的「意思」
- 意思越接近，數字就越相似
- 電腦用這些數字來比較內容

### Q3: 嵌入模型會「記住」我的文件嗎？

**A:** 不會！它只是「翻譯」：
- 輸入：文字 → 輸出：數字
- 不會儲存你的原始文件
- 每次輸入相同文字，輸出會相同

### Q4: 我該選哪個嵌入模型？

**A:** 快速決策：
- 🇹🇼 處理中文 → **Jina Embeddings v2**
- 🇬🇧 處理英文 → **all-MiniLM-L6-v2**
- 🌍 處理多語言 → **multilingual-e5-large**
- 💰 預算充足 → **OpenAI Embeddings**

### Q5: 向量資料庫會很佔空間嗎？

**A:** 看情況：
- 📄 小專案（幾千筆資料）→ 幾 MB，不用擔心
- 📚 大專案（百萬筆資料）→ 幾 GB，需要規劃
- 💡 技巧：可以壓縮或使用較小的模型

### Q6: 可以中途換嵌入模型嗎？

**A:** 可以，但要重建資料庫：
1. 用新模型重新處理所有文件
2. 生成新的向量
3. 存入資料庫
4. ⚠️ 需要時間，最好一開始就選好

---

## 📚 延伸學習資源

### 推薦閱讀順序

1. **先動手做** → 完成本課程的 [1_rag_basics.ipynb](1_rag_basics.ipynb)
2. **理解原理** → 回來細讀這份文件
3. **深入研究** → 試試不同的模型和資料庫
4. **實際應用** → 用自己的資料建立 RAG 系統

### 實用工具

- [HuggingFace Models](https://huggingface.co/models) - 尋找各種嵌入模型
- [Chroma 文檔](https://docs.trychroma.com/) - Chroma 向量資料庫官方文檔
- [LangChain 教學](https://python.langchain.com/) - RAG 系統開發框架

---

## 💡 記住這些重點就夠了！

```
📝 文字 → 🧠 嵌入模型 → 🔢 向量 → 💾 向量資料庫
                                           ↓
👤 問題 → 🧠 嵌入模型 → 🔍 搜尋 → 📄 找到答案！
```

**一句話總結**：
> 嵌入模型把文字變成數字，向量資料庫用這些數字找相關內容，就這麼簡單！
